<!doctype html> <html> <head> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1"> <link rel="icon" href="/favicon.svg"> <title>turntable - 生物烯丙菊</title> <link rel="stylesheet" href="/css/style.css"> </head> <body> <header class="head"> <h1 class="head-title"><a href="/">生物烯丙菊</a></h1> <h3 class="head-description"> <span class="flashlight">达文西手电筒</span> </h3> <ul class="head-nav"> <li><a href="/">Home</a></li> <li><a href="/archives">Archives</a></li> <li><a href="http://blog.3u3.me">幾文山</a></li> </ul> </header> <main class="main"> <article class="post"> <header class="post-head"> <time datetime="2015-03-24T17:58:49.000Z">March 24, 2015</time> <h1><a href="/post/turntable/">轉盤.</a></h1> </header> <section class="post-main"><p>從前幾天開始, 就一直發警告郵件給我說服務器的 CPU 到 108% (不知道是如何計算出來的這個值..), 並不知道是何原因(很惱怒).</p> <p>然後倆天前登陸到服務器後, 重啓了下, 之後發生了各種不愉快的事情.</p> <p>丟了好多東西, 找不回來了(不知道怎麼找...).</p> <p>那麼具體情況這麼個樣子, 服務器裝有 Mysql 和 Postgresql 倆個數據庫(貌似有建議說不要在一臺機器上裝多個數據庫的來着).</p> <p>重启了之后俩个数据库都无法启动, 各种报错, 良久也未发现是什么问题, 没辙重装了就, 然后各种备份.</p> <p>重装后添加组以及账户</p> <pre>// 添加组
# groupadd master
// 添加账户 并指定到 master 组和 sudo 组 拥有 sudo 权限
# useradd username -g master -G sudo -m</pre> <p>也可以在添加账户后在追加用户的组</p> <pre>usermod username -G sudo</pre> <p>服务器的时区并非为东八区, 这样在以后程序在获取时间的时候就和当地时间时错误的.</p> <pre>dpkg-reconfigure tzdata</pre> <p>选择亚洲 东八区 的时区就行了.</p> <p>其实这次重装最大的成就是保住了 wordpress 的数据, 对.</p> <p>Mysql 在无法启动的状况下如何进行备份把.</p> <p>找到 Mysql 的数据存储目录把目录下的所有文件都备份出来, 然后在重装后把之前备份的目录还原回去, 不必全部还原, 只要将 以库名命名的文件夹(存储表结构) 和 ibdata1 文件备份即可, ibdata1 文件即数据存储的文件.</p> <p>Mysql 数据目录在 /var/lib/mysql</p> <p>覆盖还原文件后需要降覆盖的文件 属主 和 属组 都改为 mysql , 否则 mysql 能看到这个还原的库, 但是却不能访问, 无权限进行访问.</p> <pre># chown -R mysql.mysql /var/lib/mysql/ibdata1</pre> <p>..</p> <p>也许 Postgresql 也能够用同样的方式进行复原. 不过没测试成功. 只能重来.</p> <p>还有些数据把丢失的在添加进去就成了~</p> <p> </p></section> <footer class="post-foot"> <ul class="post-tags"> <li><a href="/tag/back">back</a></li> <li><a href="/tag/mysql">mysql</a></li> <li><a href="/tag/turntable">turntable</a></li> </ul> </footer> </article> <menu class="page"> </menu> </main> <footer class="foot"> <div>&copy;2017 iaceob</div> </footer> </body> </html>