<!doctype html> <html> <head> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1"> <link rel="icon" href="/favicon.svg"> <title>jget - 生物烯丙菊</title> <link rel="stylesheet" href="/css/style.css"> </head> <body> <header class="head"> <h1 class="head-title"><a href="/">生物烯丙菊</a></h1> <h3 class="head-description"> <span class="flashlight">达文西手电筒</span> </h3> <ul class="head-nav"> <li><a href="/">Home</a></li> <li><a href="/archives">Archives</a></li> <li><a href="http://blog.3u3.me">幾文山</a></li> </ul> </header> <main class="main"> <article class="post"> <header class="post-head"> <time datetime="2015-09-27T22:48:33.000Z">September 27, 2015</time> <h1><a href="/post/jget-local-offline-download-service/">jget 本地离线下载服务</a></h1> </header> <section class="post-main"><p>几个月前入手了一台树苺派, 可是一直没能派上用场, 在那闲置, 当初买这是想做点更有科技感的事情, 可是不太现实...</p> <p>本人是个 acg 爱好者, 但苦于上不鸟 4鸡 又想在每天工作和下班路上打发打发时间, 看点动漫, 可又得提前缓存好, 若哪天忘了缓存, 那路上的时间就得无聊的望着窗外.</p> <p>遂, 就有了个想法, 做一个下载服务, 我提供一个地址, 让下载程序去慢慢下载, 等到家之后就把下载的视频 copy 到抓机, 这样就不用担心遗忘, 或者网络连接慢没下载完了, 我可以随时都添加一个任务, 让其慢慢下载去, 刚好这个树苺派也闲着, 就做了这么个 jget.</p> <p>jget 主要是两套程序, 一个 web 服务, 供添加任务, 账户信息, 另一个就是本地的下载程序.</p> <p>web 页面主要提供账户信息和账户所有的下载机信息, 这些信息是作为下载机器接入的条件, 如果并非是认证的机器接入是不允许的, 提供一个心跳服务接口, 实时刷新下载机的状态更新下载机器信息, 如果超出了所限定的时间仍然没有心跳连接, 那创建下载任务时将不出现这台机器, 可能是下载机器的网络有问题或者下载程序挂了. 每次下载机和 web 通信都应带上所需的账户验证信息, 否则将不能识别这台机器,从而不能够进行任务的处理.</p> <p>本地下载程序的主要做的事情就俩件: 服务中心心跳 和 任务获取解析, 在启动任务之前要先从 web 服务中心获取账户验证以及下载机器的验证信息, 验证通过后, 保存账户信息, 用于之后的 服务中心信息交互使用, 下载服务机的名称是作为这个账户下机器的唯一标识, 名称重复的将不会被添加当作新的机器而是当作心跳更新这个下载机的信息. 文件下载的处理俩中方式, 多线程下载和单线程下载, 首选多线程下载, 若目标服务器不支持则转为单线程, 下载模块使用的 java 实现的 <a title="Wget" href="https://github.com/axet/wget" target="_blank">wget</a> 库, 就使用而言 wget 基本上能满足下载的需求, 但是也有诸多问题, 不能设置 Cookie , 单线程下载无法获取进度(这个可能是我没发现怎么用).</p> <p>现已成功部署至树苺派并投入使用, 仍然有很多细节需要去优化, 具体代码实现在:</p> <p>http://iaceob.name:8528/gitbucket/iaceob/jget</p> <p>目前 web 界面尚未完整提供, 和尚准备来搞这界面, 搞完后会放入到 github 中.</p> <p>仍然还有很多细节处理要优化, 用着先</p></section> <footer class="post-foot"> <ul class="post-tags"> <li><a href="/tag/download">download</a></li> <li><a href="/tag/java">java</a></li> <li><a href="/tag/jget">jget</a></li> <li><a href="/tag/offline">offline</a></li> <li><a href="/tag/raspberry">raspberry</a></li> <li><a href="/tag/wget">wget</a></li> </ul> </footer> </article> <menu class="page"> </menu> </main> <footer class="foot"> <div>&copy;2017 iaceob</div> </footer> </body> </html>