<!doctype html> <html> <head> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1"> <link rel="icon" href="/favicon.svg"> <title>or - 生物烯丙菊</title> <link rel="stylesheet" href="/css/style.css"> </head> <body> <header class="head"> <h1 class="head-title"><a href="/">生物烯丙菊</a></h1> <h3 class="head-description"> <span class="flashlight">达文西手电筒</span> </h3> <ul class="head-nav"> <li><a href="/">Home</a></li> <li><a href="/archives">Archives</a></li> <li><a href="http://blog.3u3.me">幾文山</a></li> </ul> </header> <main class="main"> <article class="post"> <header class="post-head"> <time datetime="2013-10-25T16:48:45.000Z">October 25, 2013</time> <h1><a href="/post/sql-in-or-and-union-efficiency/">sql 中 or 和 union 效率</a></h1> </header> <section class="post-main"><p> </p> <p>select * from tablename where time=’2013-1-1′ or time=’2013-1-15′;</p> <p>select * from tablename where time=’2013-1-1′<br/> union<br/> select * from tablename where time=’2013-1-15′;</p> <p>or 查询会将表里面的所有数据都检索一次然后再去进行匹配</p> <p>union 查询 多个查询语句查多少数据只检索多少条</p> <p> </p> <p>去查了查 发现了俩中结果 乱了 。。。</p> <p>http://www.open-open.com/lib/view/open1346289165426.html</p> <p> </p> <blockquote> <p>笔者发现如果or两边的查询列是一样的话,那么用union则反倒和用or的执行速度差很多,虽然这里union扫描的是索引,而or扫描的是全表。</p> <p>select gid,fariqi,neibuyonghu,reader,title from Tgongwen where fariqi=‘2004-9-16‘ or fariqi=‘2004-2-5‘</p> <p>用时：6423毫秒。扫描计数 2,逻辑读 14726 次,物理读 1 次,预读 7176 次。</p> <p>select gid,fariqi,neibuyonghu,reader,title from Tgongwen where fariqi=‘2004-9-16‘</p> <p>union</p> <p>select gid,fariqi,neibuyonghu,reader,title from Tgongwen where fariqi=‘2004-2-5‘</p> <p>用时：11640毫秒。扫描计数 8,逻辑读 14806 次,物理读 108 次,预读 1144 次</p> </blockquote> <p>http://blog.csdn.net/duanjianmin/article/details/6631339</p> <p> </p> <blockquote> <p align="left"> 当SQL语句有多个or语句时，可以考虑使用union或者union all代替来提高速度。使用or的SQL语句往往无法进行优化，导致速度变慢。但这不是固定的，有时候使用or速度会更快些。具体情况还要经过测试为准。如果加索引的话，也可能实现速度优化。</p> <p align="left"> 实验表格如下,实际数据有2,000,000条，从里面返回大约最多1000行左右的数据。</p> <table id="table1" border="1"> <tbody> <tr> <td align="center" bgcolor="#c0c0c0">X</td> <td align="center" bgcolor="#c0c0c0">Y</td> <td align="center" bgcolor="#c0c0c0">Inline</td> <td align="center" bgcolor="#c0c0c0">CDP</td> <td align="center" bgcolor="#c0c0c0">T</td> </tr> <tr> <td>12002400</td> <td>5801000</td> <td>300</td> <td>300</td> <td>3400</td> </tr> <tr> <td>12002408</td> <td>5801005</td> <td>300</td> <td>301</td> <td>3402</td> </tr> <tr> <td>12002416</td> <td>5801010</td> <td>300</td> <td>302</td> <td>3404</td> </tr> <tr> <td>12002424</td> <td>5801015</td> <td>300</td> <td>303</td> <td>3406</td> </tr> <tr> <td>...</td> <td>...</td> <td>...</td> <td>...</td> <td>...</td> </tr> </tbody> </table> <p>or语句(部分节选)</p> <p align="left">SELECT * FROM tablename where (cdp= 300 and inline=301) or (cdp= 301 and inline=301) or (cdp= 302 and inline=301) or (cdp= 303 and inline=301) or (cdp= 304 and inline=301) or (cdp= 305 and inline=301) or (cdp= 306 and inline=301) or (cdp= 307 and inline=301)</p> <p align="left">union all语句(部分节选)</p> <p align="left">SELECT * FROM tablename where (inline= 300 and cdp=300) union all SELECT * FROM tablename where (inline= 301 and cdp=300) union all SELECT * FROM tablename where (inline= 302 and cdp=300) union all SELECT * FROM tablename where (inline= 303 and cdp=300)</p> <p align="left">返回不规则的900条数据，前者用了60多秒，后者用了8秒左右。</p> </blockquote> <p>到底是哪个我也不知到了，，，，</p> <p>这事还是得自己测 。。。。。</p> <p>现在也没有数据。。。。。</p> <p>过段时间有大批量的数据 就来测试测试 暂时先用or来查询</p> <p> </p> <p> </p> <p>========================== 14-08-08 修改</p> <p>这么长时间了 也使用了好多了 现在来看 in 和 or 的效率比较从大数据方面来说 in 应该会比 or 效率更高</p> <p>in的逻辑是 目标数据中使用有和 in 里面有像匹配的</p> <p>in 的查询在拿到目标数据后, 遍历判断是否有in里面相同的值</p> <p>而对用or来说, 有多少or就遍历几次目标数据,判断是否有相同的值</p> <p> </p> <p>============================14-09-27</p> <p>楼上的二货...</p> <p>标题明明写着 or union 的效率</p> <p>回什么 or 和 in</p> <p>..... 脑抽</p></section> <footer class="post-foot"> <ul class="post-tags"> <li><a href="/tag/mysql">mysql</a></li> <li><a href="/tag/or">or</a></li> <li><a href="/tag/sql">sql</a></li> <li><a href="/tag/union">union</a></li> </ul> </footer> </article> <menu class="page"> </menu> </main> <footer class="foot"> <div>&copy;2017 iaceob</div> </footer> </body> </html>