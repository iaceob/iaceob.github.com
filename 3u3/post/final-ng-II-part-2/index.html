<!DOCTYPE html><html><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><title>ng2 app - 幾文山</title><link rel="stylesheet" href="/css/main.css"><!--[if lt IE 9]><script>(function(a,b){a="abbr article aside audio bdi canvas data datalist details dialog figcaption figure footer header hgroup main mark meter nav output progress section summary template time video".split(" ");for(b=a.length-1;b>=0;b--)document.createElement(a[b])})()</script><![endif]--></head><body><header class="head"><h1 class="head-title u-fl"><a href="/">幾文山</a></h1><nav class="head-nav u-fr"><ul class="head-nav__list"><li class="head-nav__item"><a href="/" class="head-nav__link">Home</a></li><li class="head-nav__item"><a href="/archives" class="head-nav__link">Archives</a></li><li class="head-nav__item"><a href="https://iaceob.3u3.me" class="head-nav__link">生物烯丙菊</a></li></ul></nav></header><main class="main"><article class="post"><header class="post__head"><time datetime="2016-12-17T07:08:47.000Z" class="post__time">December 17, 2016</time><h1 class="post__title"><a href="/post/final-ng-II-part-2/">ng2 app</a></h1></header><div class="post__main echo"><p>繼 <a href="/post/final-ng-II-part-1" title="ng2 ngcli">上一文</a>, 通過 ngcli 已經建立了一個可運行的工程.</p>
<p>這次來熟悉 ng2 開發方式.</p>
<p>首先, 執行 <code>ng s</code> (ng server 別名) 來啟動使用 ngcli 創建的工程, 瀏覽器訪問 <code>localhost:4200</code>, 會看到一行很大的 <code>app works!</code> , 那麼就啟動成功了.</p>
<h2 id="運作方式"><a href="#運作方式" class="headerlink" title="運作方式"></a>運作方式</h2><p>在開始進行編碼之前, 先來認知 ng2 <code>component</code>, ng2 應用是由很多個 component 組成的, 一個頁面中可以有多個 component, 因此在構建頁面時可以將不同功能部分代碼拆解城多個 component.</p>
<p>打開 <code>src/app/app.component.ts</code> 文件, 可以看到這些代碼</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Component &#125; from <span class="string">'@angular/core'</span>;</span><br><span class="line"></span><br><span class="line">@Component(&#123;</span><br><span class="line">  selector: <span class="string">'app-root'</span>,</span><br><span class="line">  templateUrl: <span class="string">'./app.component.html'</span>,</span><br><span class="line">  styleUrls: [<span class="string">'./app.component.css'</span>]</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> AppComponent &#123;</span><br><span class="line">  title = <span class="string">'app works!'</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>@Component</code> 是用來聲明這個 component, 裡面有三個值 (@ 是 es6 中提出的 <a href="http://es6.ruanyifeng.com/?search=decorator&amp;x=0&amp;y=0#docs/decorator" target="_blank" rel="external">decorator</a> 語法, ):</p>
<ol>
<li><code>selector</code> 在 html 中的某個節點上使用當前 component (支持 css 選擇器, 但是如果選擇器有多個結果, 僅使用第一個)</li>
<li><code>templateUrl</code> 此 component 使用的模板文件地址</li>
<li><code>styleUrls</code> 此 component 使用的樣式文件</li>
</ol>
<p>這里默認創建的 component 所選取的節點 <code>app-root</code> 就是在 <code>src/index.html</code> 裡面</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!doctype html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>Test<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">base</span> <span class="attr">href</span>=<span class="string">"/"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"icon"</span> <span class="attr">type</span>=<span class="string">"image/x-icon"</span> <span class="attr">href</span>=<span class="string">"favicon.ico"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">app-root</span>&gt;</span>Loading...<span class="tag">&lt;/<span class="name">app-root</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>簡單的理解就是, 當執行到 app.component.ts 時, 選取 app-root 節點, 將 app component 的內容渲染進去, 整個執行過程大致為:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">src/main.ts -&gt; src/app/index.ts -&gt; [src/app/app.module.ts | src/app/app.component.ts]</span><br></pre></td></tr></table></figure>
<p>在 app.component.ts 中, 有設置一個變量 <code>title = &#39;app works!&#39;;</code> 這個 app works! 就是開啟這個應用後訪問瀏覽器所看到的文字.</p>
<p>那這個變量又是如何顯示到頁面的了?</p>
<h2 id="數據綁定"><a href="#數據綁定" class="headerlink" title="數據綁定"></a>數據綁定</h2><h3 id="模板取值"><a href="#模板取值" class="headerlink" title="模板取值"></a>模板取值</h3><p>數據綁定這個應該不陌生, 在 ng1 中也是有數據綁定概念的, ng1 中的數據綁定實現, 是通過在控制器 (controller) 中設置變量, 模板從控制器中使用  方式獲取在控制器中的變量, 獲取使用 <code>ng-bind</code> 屬性.</p>
<p>在 ng2 中也有數據綁定, 且使用方式與 ng1 也大體相同, 同是使用  在模板中獲取變量, 但是 <code>ng-bind</code> 屬性綁定方式略有改變.</p>
<p>打開 <code>src/app/app.component.html</code> 會看到</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span></span><br><span class="line">  &#123;&#123;title&#125;&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>這就是 app component 這個組件的模板, 展示 title 的內容.</p>
<blockquote>
<p>app.component.ts 在完成自己組件內容後, 將結果寫入到 app-root 標籤中, 這就是 component 的整個流程.</p>
</blockquote>
<p>接下來詳細看看的數據綁定方式</p>
<p>用標識符取值方式, 與 ng1 大體相同, 可簡單的將其看為是一個臨時的在 html 中可執行 js 腳本的區域, 當然這個可執行的 js 空間作用域僅在當前這個 component 中, 可以直接調用這個 component 中的函數或者變量.</p>
<p>例如在 app.component.ts 中修改</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> AppComponent &#123;</span><br><span class="line">  title = <span class="string">'app works!'</span>;</span><br><span class="line"></span><br><span class="line">  getDate()&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Date</span>();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>接著在 app.component.html 中添加</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span></span><br><span class="line">  &#123;&#123;title&#125;&#125;</span><br><span class="line">  &#123;&#123;'Now: ' + getDate()&#125;&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>再打開瀏覽器就能看到</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app works! Now: Sat Dec 17 2016 16:12:50 GMT+0800 (CST)</span><br></pre></td></tr></table></figure>
<p>另外一種就是 bind 數據綁定方式, 寫在標籤屬性中</p>
<p>例如在模板中添加</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> [<span class="attr">placeholder</span>]=<span class="string">"holder"</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>在 app.component.ts 中添加</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">holder=<span class="string">'Name'</span>;</span><br></pre></td></tr></table></figure>
<p>再去看頁面, 就會發現多了一個輸入框, 且輸入框有默認文字 Name</p>
<blockquote>
<p><strong>與 ng1 不同之處:</strong><br>在 ng1 中, <code>ng-bind</code> 可以接收從控制器來的數據並展示, 但是 ng-bind 展示的內容是放入到標籤之中的, 而 ng2 的綁定方式略有改變, 沒有再使用 <code>ng-bind</code>, 如果要望標籤中寫入內容可通過使用標識符方式.<br>ng1 中若要給標籤屬性複製, 通過</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">title</span>=<span class="string">"&#123;&#123;title&#125;&#125;"</span>&gt;</span>test<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>而 ng2 則是直接使用 [] 包含屬性名, 配變量值<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span> [<span class="attr">title</span>]=<span class="string">"title"</span>&gt;</span>test<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>當然, ng2 也是支持與 ng1 一樣的方式給屬性賦值.</p>
</blockquote>
<h3 id="事件綁定"><a href="#事件綁定" class="headerlink" title="事件綁定"></a>事件綁定</h3><p>事件用來捕獲用戶操作, 在 ng2 中可通過 <code>(event name)=&quot;something&quot;</code> 來進行事件捕獲.</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">name</span>=<span class="string">"button"</span> (<span class="attr">click</span>)=<span class="string">"testEvent($event)"</span>&gt;</span>Click<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">testEvent(event)&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'Test event'</span>, event);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在 app.component.html 與 app.component.ts 分別加入後, 打開瀏覽器, 點擊 Click 按鈕, 會看到控制台打印了一條 ‘Test event’ 的日誌, 且後面有一次此次 event 的詳細信息.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Test event click &#123; target: &lt;button&gt;, buttons: 0, clientX: 24, clientY: 266, layerX: 24, layerY: 266 &#125;</span><br></pre></td></tr></table></figure>
<h3 id="雙向綁定"><a href="#雙向綁定" class="headerlink" title="雙向綁定"></a>雙向綁定</h3><p>與 ng1 形同, ng2 也支持數據的雙向綁定, 也就是無論是模板中修改了某個變量的值, 同時會在 component 中修改該變量的值, 使用方式與 ng1 大致相同.</p>
<p>在 app.component.html 中加入</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> [(<span class="attr">ngModel</span>)]=<span class="string">"title"</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>然後打開瀏覽器, 會看到一個輸入框, 且賦值為 <code>app works!</code>, 可以去嘗試修改這個輸入框會發生什麼事情.</p>
<h2 id="component-通信-amp-amp-流程控制"><a href="#component-通信-amp-amp-流程控制" class="headerlink" title="component 通信 &amp;&amp; 流程控制"></a>component 通信 &amp;&amp; 流程控制</h2><h3 id="Input"><a href="#Input" class="headerlink" title="Input"></a>Input</h3><p>一個頁面中可能存在多個 component, component 之間的通信可通過 <code>@Input</code> <code>@Output</code> 進行通信.</p>
<p>示例:</p>
<p>首先, 通過 <code>ng</code> 創建一個新的 component</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ng g c comp/show</span><br></pre></td></tr></table></figure>
<p>創建一個名為 show 的 component, 放置與 src/app/comp/show 目錄 (自動放置, 但是 comp 目錄需要自己創建, 具體參考 <a href="/post/final-ng-II-part-1">ng2 ngcli</a>).</p>
<p>創建完成後, 目錄結構像這樣</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">src/app/comp</span><br><span class="line">└── show</span><br><span class="line">    ├── show.component.css</span><br><span class="line">    ├── show.component.html</span><br><span class="line">    ├── show.component.spec.ts</span><br><span class="line">    └── show.component.ts</span><br></pre></td></tr></table></figure>
<p>接著, 到 app.component.html 中增加 </p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">app-show</span>&gt;</span><span class="tag">&lt;/<span class="name">app-show</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>讓 show 組件的內容顯示在 app 中, 這裡的 app-show 標籤可以是自定義的, 但是自定義的話, 就需要去修改 <code>show.component.ts</code> 中關於 component 組件聲明的 <code>selector</code> 選擇器. 只要二者相同即可.</p>
<p>這時打開網頁就能看到, 在頁面中已經加入了 show component 的內容了.</p>
<p>接下來, 使用創建一個數據模型(接口) interface 用於指定數據格式. (interface 是 typescript 提供的語法, 其目的就是為了創建一個統一的數據模型.)</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ng g interface entity/item</span><br></pre></td></tr></table></figure>
<p>編輯添加的文件, 修改內容為</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> Item &#123;</span><br><span class="line">    id: <span class="built_in">number</span>;</span><br><span class="line">    value: <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在 app.component.ts 頂部引入 Item</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Item &#125; from <span class="string">'./entity/item'</span>;</span><br></pre></td></tr></table></figure>
<p>並且加入幾個預定義數據, 最終 app.component.ts 像這樣</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Component &#125; from <span class="string">'@angular/core'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Item &#125; from <span class="string">'./entity/item'</span>;</span><br><span class="line"></span><br><span class="line">@Component(&#123;</span><br><span class="line">    selector: <span class="string">'app-root'</span>,</span><br><span class="line">    templateUrl: <span class="string">'./app.component.html'</span>,</span><br><span class="line">    styleUrls: [<span class="string">'./app.component.css'</span>]</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> AppComponent &#123;</span><br><span class="line">    title = <span class="string">'app works!'</span>;</span><br><span class="line"></span><br><span class="line">    holder = <span class="string">'Name'</span>;</span><br><span class="line"></span><br><span class="line">    items: Item[] = [</span><br><span class="line">      &#123;id: <span class="number">1</span>, value: <span class="string">'Europe'</span>&#125;,</span><br><span class="line">      &#123;id: <span class="number">2</span>, value: <span class="string">'Africa'</span>&#125;,</span><br><span class="line">      &#123;id: <span class="number">3</span>, value: <span class="string">'Oceania'</span>&#125;</span><br><span class="line">    ];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> getDate() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Date</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> testEvent(event: MouseEvent) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'Test event'</span>, event);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>接下來的步驟就是通信的實現.</p>
<p>再次打開剛剛編輯的 app.component.html, 將剛剛添加的 app-show 添加一個屬性</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;app-show [itemList]=<span class="string">"items"</span>&gt;&lt;<span class="regexp">/app-show&gt;</span></span><br></pre></td></tr></table></figure>
<p>這裡表達的是, 將 itemList 視為一個屬性, 並且將 items 傳遞進 app-show 中, 那麼在 app-show 中就可以通過 <code>@Input</code> 來獲取這個 <code>itemList</code>, 因此修改 show.component.ts 為</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Component, OnInit, Input &#125; from <span class="string">'@angular/core'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Item &#125; from <span class="string">'../../entity/item'</span>;</span><br><span class="line"></span><br><span class="line">@Component(&#123;</span><br><span class="line">  selector: <span class="string">'app-show'</span>,</span><br><span class="line">  templateUrl: <span class="string">'./show.component.html'</span>,</span><br><span class="line">  styleUrls: [<span class="string">'./show.component.css'</span>]</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> ShowComponent <span class="keyword">implements</span> OnInit &#123;</span><br><span class="line"></span><br><span class="line">  @Input() itemList: Item[];</span><br><span class="line"></span><br><span class="line">  <span class="keyword">constructor</span>() &#123; &#125;</span><br><span class="line"></span><br><span class="line">  ngOnInit() &#123;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>首先, 從 <code>&#39;@angular/core&#39;</code> 中加入引用 <code>Input</code>, 接著引入 <code>Item</code> 因為 傳遞進來的數據就是 Item 類型.</p>
<p>之後就是新增的 <code>@Input() itemList: Item[];</code> 這樣一行代碼, 就是用來接收從 app component 中傳遞過來的 item 數據.<br>其 <code>@Input</code> 就是用來表示數據是從外部輸入進來, Input 默認將後面的變量名作為接收的屬性名稱, 同時也可以自定義, <code>@Input(itemList) items: item[]</code> , 這樣就表示是從 itemList 屬性接收屬性, 將值賦給 items 變量.</p>
<h3 id="流程控制"><a href="#流程控制" class="headerlink" title="流程控制"></a>流程控制</h3><h4 id="ngFor"><a href="#ngFor" class="headerlink" title="ngFor"></a>ngFor</h4><p>通過 Input 在 show 組件中已經能接收到從 app 組件中傳遞的 items<br>那麼, 在 show 組件中, 就能通過 ngFor 來展示這些 item.</p>
<p>修改 show.component.html 為如下內容:</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span> *<span class="attr">ngFor</span>=<span class="string">"let item of items"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">label</span> <span class="attr">htmlFor</span>=<span class="string">"&#123;&#123;item.id&#125;&#125;"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">"&#123;&#123;item.id&#125;&#125;"</span> <span class="attr">type</span>=<span class="string">"checkbox"</span>&gt;</span> &#123;&#123; item.value &#125;&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>這裡使用了 <code>*ngFor</code> 來遍歷從 app 組件中傳遞過來的 items.<br>需要注意的是 <code>htmlFor</code>, 此處主要是因為 for 為 javascript 關鍵字, 所以此處將其換為 htmlFor, 此外也可以只用 <code>attr.for</code> 的方式, 表示此為 html 屬性.</p>
<h4 id="ngIf"><a href="#ngIf" class="headerlink" title="ngIf"></a>ngIf</h4><p><code>ngIf</code> 用於進行邏輯判斷, 例如這裡, 如果有超過 2 個 item 就提示數量過多</p>
<p>那麼就在 show.component.html 最後加入</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span> *<span class="attr">ngIf</span>=<span class="string">"items.length &gt; 2"</span>&gt;</span>Items length <span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">"color: #f00"</span>&gt;</span>(&#123;&#123;items.length&#125;&#125;)<span class="tag">&lt;/<span class="name">span</span>&gt;</span> too much<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="Output"><a href="#Output" class="headerlink" title="Output"></a>Output</h3><p>為了說明 Output, 再來建立一個 component 叫做 add, 用向 app 的 items 中添加新的數據.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ng g c comp/add</span><br></pre></td></tr></table></figure>
<p>然後將 add 組件的模板加入到 app 中, 也就是在 app.component.html 中加入 app-add 標籤, 並且在標籤中添加一個叫做 addItem 的事件綁定</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">app-add</span> (<span class="attr">addAppItem</span>)=<span class="string">"addAppItem($event)"</span>&gt;</span><span class="tag">&lt;/<span class="name">app-add</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>左側的 <code>(addItem)</code> 是用於給 add 組件向外綁定事件指定的事件名稱, 右側的 <code>addItem($event)</code> 則是調用此模板所屬的組件, 此處所屬的組件是 app, 也就是調用 <code>app.component.ts</code> 中的 addItem 方法.<br>那麼就在 app.component.ts 中添加該方法.</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">addItem(value) &#123;</span><br><span class="line">    <span class="keyword">this</span>.items.push(&#123;</span><br><span class="line">        id: +<span class="keyword">new</span> <span class="built_in">Date</span>(),</span><br><span class="line">        value: value</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>剩下來的事就是, 在 add 組件中, 增加一個表單, 使其添加的數據提交給 app 組件中的 addItem 方法就能夠完成數據的添加了.</p>
<p>add.component.html</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> [(<span class="attr">ngModel</span>)]=<span class="string">"value"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> (<span class="attr">click</span>)=<span class="string">"addItem($event)"</span>&gt;</span>Add<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>add.component.ts</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Component, OnInit &#125; from <span class="string">'@angular/core'</span>;</span><br><span class="line"></span><br><span class="line">@Component(&#123;</span><br><span class="line">  selector: <span class="string">'app-add'</span>,</span><br><span class="line">  templateUrl: <span class="string">'./add.component.html'</span>,</span><br><span class="line">  styleUrls: [<span class="string">'./add.component.css'</span>]</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> AddComponent <span class="keyword">implements</span> OnInit &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">constructor</span>() &#123; &#125;</span><br><span class="line"></span><br><span class="line">  ngOnInit() &#123;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  value;</span><br><span class="line"></span><br><span class="line">  addItem($event) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.value);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>那麼, add 的表單功能完成, 並且能收到添加的 item, 最後, 就是將收到的值傳給 app 組件, 將其加入到 app 組件中的 items 然後在 show 組件中進行顯示.</p>
<p>傳遞 add 中輸入的值就是使用 <code>@Output</code></p>
<p>Output 使用, 首先在 add 組件中引入 Output 以及 EventEmitter, 在 add.component.ts 中修改 import</p>
<p>add.component.ts</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Component, OnInit, Output, EventEmitter &#125; from <span class="string">'@angular/core'</span>;</span><br></pre></td></tr></table></figure>
<p>然後添加一個用來處理事件的 EventEmmitter, 將 add 組件中的添加事件通過 EventEmmitter 傳遞出此組件到其他組件.</p>
<p>最終 add.component.ts 看起來像這樣</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Component, OnInit, Output, EventEmitter &#125; from <span class="string">'@angular/core'</span>;</span><br><span class="line"></span><br><span class="line">@Component(&#123;</span><br><span class="line">  selector: <span class="string">'app-add'</span>,</span><br><span class="line">  templateUrl: <span class="string">'./add.component.html'</span>,</span><br><span class="line">  styleUrls: [<span class="string">'./add.component.css'</span>]</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> AddComponent <span class="keyword">implements</span> OnInit &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">constructor</span>() &#123; &#125;</span><br><span class="line"></span><br><span class="line">  ngOnInit() &#123;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  value;</span><br><span class="line"></span><br><span class="line">  @Output() addAppItem = <span class="keyword">new</span> EventEmitter();</span><br><span class="line"></span><br><span class="line">  addItem($event) &#123;</span><br><span class="line">    <span class="comment">// console.log(this.value);</span></span><br><span class="line">    <span class="keyword">this</span>.addAppItem.emit(<span class="keyword">this</span>.value);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>@Output() addAppItem = new EventEmitter();</code> 就是用來創建一個事件, addItem 是 add 組件中定義的事件, 用於接收 add 模板的點擊, 當點擊後, 將這個事件通過 上面創建的 EventEmitter 轉發出此組件所在的父組件, 此處也就是 app 中, 至於最終尋找的是父組件中的哪一個事件, 與 Input 一樣, Output 默認去後面的參數名, 也可以通過 <code>@Output(&#39;name&#39;)</code> 指定.</p>
<p>到這裡, component 通信以及流程控制就完成了, 從添加到展示全部實現.</p>
<h2 id="樣式"><a href="#樣式" class="headerlink" title="樣式"></a>樣式</h2><p>ng2 與 ng1 還有個很大不同的地方是, ng1 中樣式的管理方式, 任何一個控制器所使用 class 都是通用的. 而 ng2 則增加了作用域的概念, 看使用 ngcli 創建的 component 就能發現, 創建組件的時候, 給增加了 一個 name.component.css 的文件, 該文件就是這個組件所獨有的樣式文件, 添加的任何樣式都不會影響到其他的組件, 同時一個組件中還可以使用多個樣式文件, 只要在 component 聲明中指定文件地址即可</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@Component(&#123;</span><br><span class="line">  selector: <span class="string">'app-add'</span>,</span><br><span class="line">  templateUrl: <span class="string">'./add.component.html'</span>,</span><br><span class="line">  styleUrls: [<span class="string">'./add.component.css'</span>, <span class="string">'./add-2.component.css'</span>]</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>除了獨有的樣式文件, 也有所有公用的樣式文件, 該文件的位置為 <code>src/styles.css</code> 在該文件中添加的樣式是所有組件都能夠使用的.</p>
<p>一些測試.<br>如上面案例的列表展示, 實現隔行換色的效果.</p>
<p>在 show.component.css 中添加 light 樣式</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.light</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: <span class="number">#ccc</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然後修改 show.component.html 的遍歷</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span> *<span class="attr">ngFor</span>=<span class="string">"let item of items; let i = index"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">label</span> <span class="attr">htmlFor</span>=<span class="string">"&#123;&#123;item.id&#125;&#125;"</span> [<span class="attr">ngClass</span>]=<span class="string">"&#123;'light': i%2==0&#125;"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">"&#123;&#123;item.id&#125;&#125;"</span> <span class="attr">type</span>=<span class="string">"checkbox"</span>&gt;</span> &#123;&#123; item.value &#125;&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>這裡, 在 ngFor 中增加了一個獲取當前索引的變量 i, 接著, 在 label 標籤中增加了 ngClass 用來實現隔行換色.</p>
<p>如果, 將 light 樣式放入到 add.component.css 中就會發現, 隔行換色沒有了效果, 放入到 src/styles.css 中發現也是可用的.</p>
<h2 id="總結"><a href="#總結" class="headerlink" title="總結"></a>總結</h2><p>ng2 中一個比較亂的地方, 就是各種使用 [] () , 很容易就弄暈, 是該用 [] 還是 (), 甚至還有 [()] 這種方式….<br>簡單的來說</p>
<ul>
<li><strong>[]</strong> 用來進行 <a href="#模板取值">屬性綁定</a><br>屬性綁定又分幾種<ul>
<li>html 標籤自帶屬性綁定, 例如 <code>[title]=&quot;title&quot;</code></li>
<li>ng2 提供的屬性, 例如 <code>[ngClass]=&quot;light&quot;</code>, 通常值會有獨特的用法</li>
<li>自定義屬性, 例如文中的 <code>[itemList]</code>, 但是這個自定義屬性一定要有去實現的地方, 文中的 itemList 就是讓 show.component.ts 使用 @Input 接收</li>
</ul>
</li>
<li><strong>()</strong> 用來進行 <a href="#事件綁定">事件綁定</a></li>
<li><strong>[()]</strong> 用來進行 <a href="#雙向綁定">雙向綁定</a></li>
<li><strong>*</strong> 用來標識是 ng2 提供的屬性<br>例如 <code>*ngFor</code> <code>*if</code> , 可在值中輸入 js 腳本</li>
</ul>
<p>ng2 相對 ng1 來說確實是複雜很多, 再有一個是這裡使用的是 TypeScript, 在寫 ng2 的時候至少應該要對 TypeScript 有著相應的瞭解, 雖然說可以切換為 JavaScript 或者其他腳本去實現, 看你喜好.</p>
<p>ng2 剩下來要說的就是路由功能了, 然而 angular2 現在雖然已經進入正式版了, 但是目前 ngcli 仍然不能創建路由 (ng g r), 關於路由的使用方式可以看官方文檔 <a href="https://angular.io/docs/ts/latest/guide/router.html" target="_blank" rel="external">Routing &amp; Navigation </a>.</p>
<p>都第二天了…. 寫好久 = =</p>
<p>就這樣吧 ~</p>
</div><footer class="post__foot u-cf"><ul class="post__tag u-fl"><li class="post__tag__item"><a href="/tags/ng2/" class="post__tag__link">ng2</a></li><li class="post__tag__item"><a href="/tags/angularjs/" class="post__tag__link">angularjs</a></li></ul><a href="/post/final-ng-II-part-2/#disqus_thread" class="post__foot-link u-fr">0 COMMENTS</a></footer></article></main><footer class="foot"><div class="foot-copy u-fl">&copy; 2017 iaceob</div><menu class="page-menu u-fr"><li class="page-menu__item"><a title="Previous" href="/post/moan-part-2/" class="page-menu__link icon-arrow-left"></a></li><li class="page-menu__item"><a title="Next" href="/post/letsencrypt-auto-shell/" class="page-menu__link icon-arrow-right"></a></li></menu></footer></body></html>