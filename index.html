<!DOCTYPE html><html><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><title>幾文山</title><link rel="stylesheet" href="/css/main.css"><!--[if lt IE 9]><script>(function(a,b){a="abbr article aside audio bdi canvas data datalist details dialog figcaption figure footer header hgroup main mark meter nav output progress section summary template time video".split(" ");for(b=a.length-1;b>=0;b--)document.createElement(a[b])})()</script><![endif]--></head><body><header class="head"><h1 class="head-title u-fl"><a href="/">幾文山</a></h1><nav class="head-nav u-fr"><ul class="head-nav__list"><li class="head-nav__item"><a href="/" class="head-nav__link">Home</a></li><li class="head-nav__item"><a href="/archives" class="head-nav__link">Archives</a></li><li class="head-nav__item"><a href="https://iaceob.3u3.me" class="head-nav__link">生物烯丙菊</a></li></ul></nav></header><main class="main"><article class="post"><header class="post__head"><time datetime="2017-03-18T08:10:28.000Z" class="post__time">March 18, 2017</time><h1 class="post__title"><a href="/post/jfinal-restful/">JFinal RESTful</a></h1></header><div class="post__main echo"><p>在阅读之前, 先参考</p>
<ol>
<li><a href="http://www.jfinal.com/project/1" target="_blank" rel="external">JFinal 极速开发框架</a></li>
<li><a href="http://www.ruanyifeng.com/blog/2014/05/restful_api.html" target="_blank" rel="external">RESTful API 设计指南</a></li>
<li><a href="https://www.oschina.net/question/552061_249032" target="_blank" rel="external">JFinal实现严格的Restful</a></li>
</ol>
<p>当看完这些之后, 大概应该就能理解, RESTful 的规范, 以及 JFinal 的路由实现方式.</p>
<p>首先, 先看下 JFinal 目前的 RESTful 风格路由实现.</p>
<p>翻开 <code>com.jfinal.core.ActionMapping#getAction</code> 方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line"> * Support four types of url</span><br><span class="line"> * 1: http://abc.com/controllerKey                 ---&gt; 00</span><br><span class="line"> * 2: http://abc.com/controllerKey/para            ---&gt; 01</span><br><span class="line"> * 3: http://abc.com/controllerKey/method          ---&gt; 10</span><br><span class="line"> * 4: http://abc.com/controllerKey/method/para     ---&gt; 11</span><br><span class="line"> * The controllerKey can also contains "/"</span><br><span class="line"> * Example: http://abc.com/uvw/xyz/method/para</span><br><span class="line"> */</span></span><br><span class="line"><span class="function">Action <span class="title">getAction</span><span class="params">(String url, String[] urlPara)</span> </span>&#123;</span><br><span class="line">  Action action = mapping.get(url);</span><br><span class="line">  <span class="keyword">if</span> (action != <span class="keyword">null</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> action;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// --------</span></span><br><span class="line">  <span class="keyword">int</span> i = url.lastIndexOf(SLASH);</span><br><span class="line">  <span class="keyword">if</span> (i != -<span class="number">1</span>) &#123;</span><br><span class="line">    action = mapping.get(url.substring(<span class="number">0</span>, i));</span><br><span class="line">    urlPara[<span class="number">0</span>] = url.substring(i + <span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> action;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里有说明, 目前 JFinal 支持的路由格式, 在此之外, JFinal 还提供了一个 <code>Restful</code> 的拦截器, 来达到严格的 RESTful url 风格实现.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line"> * Invocation 中添加 Method method</span><br><span class="line"> *</span><br><span class="line">  The standard definition is as follows:</span><br><span class="line">  index - GET - A view of all (or a selection of) the records</span><br><span class="line">  show - GET - A view of a single record</span><br><span class="line">  add - GET - A form to post to create</span><br><span class="line">  save - POST - Create a new record</span><br><span class="line">  edit - GET - A form to edit a single record</span><br><span class="line">  update - PUT - Update a record</span><br><span class="line">  delete - DELETE - Delete a record</span><br><span class="line"> *</span><br><span class="line"> * GET    /user      ---&gt;  index</span><br><span class="line"> * GET    /user/id    ---&gt;  show  </span><br><span class="line"> * GET    /user/add    ---&gt;  add</span><br><span class="line"> * POST    /user      ---&gt;  save</span><br><span class="line"> * GET    /user/edit/id  ---&gt;  edit</span><br><span class="line"> * PUT    /user/id    ---&gt;  update</span><br><span class="line"> * DELETE  /user/id    ---&gt;  delete</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Restful</span> <span class="keyword">implements</span> <span class="title">Interceptor</span> </span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>当看完这些之后, 进入到正题.</p>
<p>首先, JFinal 基本上已经可以很好的实现 RESTful 风格的 url 了, 但是仍然有不足, 无论是默认的路由实现, 或者是 Restful 拦截器的实现, 仍然无法做到全可控的 RESTful 实现.<br>Restful 拦截器的实现实际上是匹配链接以及 Request method, 然后进行 forward 到相应的 action 中.</p>
<p>例如, 参考链接 <a href="http://www.ruanyifeng.com/blog/2014/05/restful_api.html" target="_blank" rel="external">RESTful API 设计指南</a> 文章中的</p>
<blockquote>
<p>DELETE /zoos/ID/animals/ID：删除某个指定动物园的指定动物</p>
</blockquote>
<p>就没办法通过 Restful 拦截器来实现了.</p>
<p>那么, 所有问题都抛出来了.</p>
<p>因此, 这里要说的就是, 把 JFinal 的路由机制给改了下, 达到完美兼容 RESTful 链接, 并且保留 JFinal 的默认实现.</p>
<p>具体实现代码已提交至 <a href="https://github.com/iaceob/jfinal/tree/restful" target="_blank" rel="external">iaceob/jfinal</a></p>
<p>先不讨论怎么实现, 其实原理也很简单, 看看代码很容易理解. 这里主要说说使用方式, 以及一些问题.</p>
<p>使用的时候非常简单, 首先在你的 AppConfig.configConstant 中, 设置开启 RESTful 模式.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">configConstant</span><span class="params">(Constants constants)</span> </span>&#123;</span><br><span class="line">    constants.setRestful(<span class="keyword">true</span>);</span><br><span class="line">    constants.setXxx();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>当设置了 <code>constants.setRestful(true);</code> 之后, 路由解析就是 RESTful 风格实现的, 默认是 false, 也就是目前 JFinal 自身的路由实现.</p>
<p>接下来就是定义你的 RESTful 链接格式就好, 下面是一个测试案例.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jfinal.test.restful.test.ctl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.jfinal.core.ActionKey;</span><br><span class="line"><span class="keyword">import</span> com.jfinal.core.Controller;</span><br><span class="line"><span class="keyword">import</span> com.jfinal.plugin.activerecord.Record;</span><br><span class="line"><span class="keyword">import</span> com.jfinal.restful.Method;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.Enumeration;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> * Created by iaceob on 2017/3/17.</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ZooCtl</span> <span class="keyword">extends</span> <span class="title">Controller</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> List&lt;Record&gt; <span class="title">getAttrs</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        List&lt;Record&gt; rets = <span class="keyword">new</span> ArrayList&lt;Record&gt;();</span><br><span class="line">        Enumeration&lt;String&gt; ens = <span class="keyword">super</span>.getAttrNames();</span><br><span class="line">        <span class="keyword">while</span> (ens.hasMoreElements()) &#123;</span><br><span class="line">            String key = ens.nextElement();</span><br><span class="line">            rets.add(<span class="keyword">new</span> Record().set(key, <span class="keyword">super</span>.getAttr(key)));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> rets;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> Record <span class="title">buildRet</span><span class="params">(String intro)</span> </span>&#123;</span><br><span class="line">        Record ret = <span class="keyword">new</span> Record();</span><br><span class="line">        ret.set(<span class="string">"intro"</span>, intro)</span><br><span class="line">                .set(<span class="string">"attrs"</span>, <span class="keyword">this</span>.getAttrs())</span><br><span class="line">                .set(<span class="string">"paras"</span>, <span class="keyword">super</span>.getParaMap());</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ActionKey</span>(<span class="string">"/zoo"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">list</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.renderJson(<span class="keyword">this</span>.buildRet(<span class="string">"zoo list"</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ActionKey</span>(value = <span class="string">"/zoo"</span>, method = Method.POST)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addZoo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.renderJson(<span class="keyword">this</span>.buildRet(<span class="string">"add zoo"</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ActionKey</span>(<span class="string">"/zoo/:id"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getZoo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.renderJson(<span class="keyword">this</span>.buildRet(<span class="string">"get zoo by id"</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ActionKey</span>(value = <span class="string">"/zoo/:id"</span>, method = Method.PUT)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">putZoo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.renderJson(<span class="keyword">this</span>.buildRet(<span class="string">"put zoo by id"</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ActionKey</span>(value = <span class="string">"/zoo/:id"</span>, method = Method.PATCH)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">patchZoo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.renderJson(<span class="keyword">this</span>.buildRet(<span class="string">"patch zoo by id"</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ActionKey</span>(value = <span class="string">"/zoo/:id"</span>, method = Method.DELETE)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteZoo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.renderJson(<span class="keyword">this</span>.buildRet(<span class="string">"delete zoo by id"</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ActionKey</span>(<span class="string">"/zoo/:id/animals"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">animals</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.renderJson(<span class="keyword">this</span>.buildRet(<span class="string">"show zoo animals"</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ActionKey</span>(<span class="string">"/zoo/:zooId/animal/:animalId"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getAnimal</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.renderJson(<span class="keyword">this</span>.buildRet(<span class="string">"show zoo animal by id"</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ActionKey</span>(<span class="string">"/zoo/:zid/animal2/:aid"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getAnimal2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.renderJson(<span class="keyword">this</span>.buildRet(<span class="string">"show zoo animal by id, 2"</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>使用时也是使用 <code>@ActionKey</code> 注解, url 中的值通过 <code>:name</code> 来标识, ActionKey 注解中的另外一个参数就是绑定相应的请求 method.</p>
<p>获取参数也未作改变, 表单传递的参数仍然通过 <code>getPara()</code> 来获取, 使用方式详细见 JFinal 文档.</p>
<p>但是需要注意的是:</p>
<ol>
<li><p>开启 RESTful 模式后, <code>getPara()</code> 方法按索引取值的方法将失去效果<br>例如, <code>/zoo/:id/1-3</code> 若这样的请求则会直接返回 404 错误, 因为 RESTful 模式采用的匹配规则较严格(可查看代码实现, 或对该处进行修改令其支持), 另外若是采用 RESTful 风格链接, 应该也不会使用此方式传参.</p>
</li>
<li><p>存放在 url 中的参数标识无法通过 <code>getPara()</code> 取值.<br>若要获取 url 中指定的参数值, 需要通过 <code>getAttr()</code> 获取, 例如 <code>/zoo/:id</code> 获取这个 id 时, 使用 <code>getAttr(&quot;id&quot;)</code>.</p>
</li>
<li><p>RESTful 模式与非 RESTful 的 ActionKey 是不可共用的.<br>这个描述可能比较模糊, 但是要表达的意思是, 如果 ActionKey 中的 url 是采用 RESTful 风格写的, 但是却没有开启 RESTful 模式, 就会发生问题, 非 RESTful 模式是不去分析 url 中参数的.</p>
</li>
<li><p>无需再使用 POST GET 拦截器<br>JFinal 提供了 GET POST 拦截器, 用以指定某个路由只能某中请求, 但是开启 RESTful 模式后, 在路由匹配是就已经限定了指定的 method 访问, 因此无需再使用 <code>@Before(POST.class)</code> 这样的代码.</p>
</li>
</ol>
<p>使用方式大抵如此, 剩下还有一些可能会令人不爽的小问题.</p>
<ol>
<li><p>使用 <code>getAttr()</code> 获取 url 中参数时, 获取到的值都是 String 类型.<br>因 <code>HttpServletRequest</code> 自身的设计, 在解析完 url 后无法将值写入到 <code>parameter</code> 中, 因此无法使用 JFinal 提供的 <code>getPara()</code> 取值. 后续也考虑过做一个类型自动识别, 但是最终抛弃了, 在不同的系统中, 参数的类型都不同, 自动识别是不靠谱的, 因此建议使用中, 在获取这个参数时都写一个 <code>validator</code> 对这个值进行验证, <code>controller</code> 中就可以对该值进行强转类型.</p>
</li>
<li><p>性能问题<br>也不要想得太过与悲观, 这里说的性能只是相对于 JFinal 自身的路由实现. JFinal 的路由实现非常简单, 甚至可以就简单的看成是字符串匹配, 但是这里的 RESTful 模式, 匹配时使用了正则, 因此效能肯定会比 JFinal 自身实现要来的低一些. 后续会做相关方面性能测试.</p>
</li>
<li><p>非插拔式<br>意思是, 并非提供扩展, 而是通过修改内核实现, 其原因其实看看 JFinal 提供 <code>Restful</code> 拦截器就知道了 = =, 以及 JFinal 的极简的设计缘故. 首先, JFinal 的路由实现, 路由最初加载进来时, 就通过 ActionMapping 隐射到具体的 Action 中, 随后只要有请求就通过 ActionHandler 找到具体的 Action, 因此想要在此基础上实现 RESTful 几乎是不可能, Restful 拦截器的实现也只能通过 forward 来实现, 且无法在 url 中指定参数. 也就是说, 无论你是加自己的过滤器, 甚至创建一个新的注解, 在请求进来时最先经过的 ActionHandler 就以及拒绝了请求, 无法进入到新定义的路由处理中. 因此要实现就只能从 ActionMapping 中入手, 修改路由实现方式.</p>
</li>
</ol>
<p>基本就这样.</p>
</div><footer class="post__foot u-cf"><ul class="post__tag u-fl"><li class="post__tag__item"><a href="/tags/jfinal/" class="post__tag__link">jfinal</a></li><li class="post__tag__item"><a href="/tags/restful/" class="post__tag__link">restful</a></li></ul><a href="/post/jfinal-restful/#disqus_thread" class="post__foot-link u-fr">0 COMMENTS</a></footer></article><article class="post"><header class="post__head"><time datetime="2017-03-03T14:23:18.000Z" class="post__time">March 3, 2017</time><h1 class="post__title"><a href="/post/moan-4/">不间断呻吟</a></h1></header><div class="post__main echo"><p>首先, 不要太相信文章的时间, 今天是 2017.03.03, 前一篇早在上个月就已经建好了, 可是一直没有写. 也就是该文创建的前一天, 读完了《甲骨文》, 就我看过之后的感觉还不错, 扒出很多被遗忘的事情, 就是前不久火的《返校》里说的一样, 「是真的忘记了, 还是不愿意想起来」.</p>
<p>该书是何伟著的关于中国三部曲之一, 还有一本《寻路中国》, 已经不打算看了, 就已经拜读的两本书来看, 大致能够明白作者想要表达的事情以及观点, 就事实而言, 现今能有很详细描述近代这些事情的人是很了不起的, 至少如果在我们真的忘记了之后还能有人告诉我们有这些事情发生过.</p>
<p>谈谈最近的事情吧.</p>
<p>算是摆脱了毫无规划的工作上, 但是才刚摆脱又感觉像是踩到了屎堆里. 至少在我来这里之前从未想到会是现在的这种情况, 同期一起的另外一人很萧然的第二天就离去了, 他看出来了这些问题, 在这里对自己的提升是非常有限的, 奈何, 我却无法做出这样的决定, 最大的问题其实还是来自自己, 并没有在早期很好的武装自己, 这也是无奈的选择, 期盼至少不坑.</p>
<p>暂时还没有置办网络, 导致的后果是看书的频率以及耐心远远高出以往.</p>
<p>仍然与以前的自己一样, 无法或者说不能在其他人面前表述自己, 仍然想要营造自己的舒适圈, 弄巧成拙.</p>
<p>一些事情只想自己闷在心里, 细细品味一番, 还真是了不得了, 都已经坚持这么久了.</p>
<p>孤单的最后结果就是 忘记 不想 和其他人接触.</p>
<p>无法对其他人敞开心扉.</p>
<p>永远不能展示最真实的自己.</p>
<p>好吧. 就这样吧, 还能怎么样了? 连自己都无法战胜的人, 如何去战胜其他人. 到底还是要抛弃自己?</p>
<p>记得曾经我说过, 「没有想与不想, 只有愿意与不愿意.」</p>
<blockquote>
<p>「我个人相信他可以撑到世界末日.」 福特说.<br>「是喔.」 亚瑟说. 「那是多久?」<br>「大概十二分钟以后.」福特说. 「来吧, 我得喝一杯.」</p>
</blockquote>
</div><footer class="post__foot u-cf"><ul class="post__tag u-fl"><li class="post__tag__item"><a href="/tags/moan/" class="post__tag__link">moan</a></li></ul><a href="/post/moan-4/#disqus_thread" class="post__foot-link u-fr">0 COMMENTS</a></footer></article><article class="post"><header class="post__head"><time datetime="2017-02-21T04:30:02.000Z" class="post__time">February 21, 2017</time><h1 class="post__title"><a href="/post/used-word/">被利用的文字</a></h1></header><div class="post__main echo"><p>中文书写系统经历过无数次的改变, 从最初的象形文字, 到甲骨文, 再到现今的文字书写系统, 以经历了上千年; 包括现今地球上现存的种种文字书写系统也都与中文书写相同类似, 经历了很多的变革, 才形成现今的文字.</p>
<p>但是, 无论是中文的象形文字系统, 或者是罗马字的表意系统文字, 出现的目的都只是被利用而已, 虽然各个时期被利用的目的都不尽相同.</p>
<p>从可考的历史来看, 最初的文字几乎都是象形文字, 使用与原物类似的符号标记为某一件事物, 包括锲型文字以及甲骨文. 当然, 现今已经无法考证文字具体是如何诞生的, 若是从象形文字的初衷来说, 文字应该就只是被利用来记录某些事物而已.</p>
<p>与中文系统不同的是, 锲型文字作为最早出现的象形文字系统, 在后续的发展中并未能像中文一样, 能够完好的保存至今, 而是被表意文字所替代, 究其原因, 并非像进化论所描述的一样, 优剩劣汰, 中文就是一个很好的印证, 没有任何证据能表明, 表意文字优秀于象形文字, 今日, 不难看出, 实际上象形文字因为其字库丰富所能表达出的语境比表意罗马字系统所能表达出更多更丰富的含义, 锲型文字的消失, 究其原因实质上是就是被利用了而已, 被使用罗马字系统的人; 古中亚, 欧洲, 曾出现过强盛的帝国, 这些使用锲型文字的地区都被征服了, 在其统治时期, 文字渐渐发生改变, 以至于后来的人们都忘记的锲型文字该如何书写.</p>
<p>中文系统因为所在区域的关系, 避免了这样的灾难, 从而得到了很好的发展, 并且影响了整个东亚地区, 现今多数东亚地区的文字书写系统或多或少都有受到中文的影响.</p>
<p>日语的出现, 可以说几乎是参考中文实现的, 从日本有文字开始, 最初几乎全部使用汉字作为载体, 但是到了后期因为诸多原因, 才导致了日文的出现, 而最大的目的仍然是利用中文的书写系统早就自己的文字. 在日本近代时期, 曾有计划全部抛弃中文书写系统, 全部使用日文假名, 但是在整改后发现, 其导致文字便的更加复杂, 这种做法也只是利用文字来摆脱与中文的关系.</p>
<p>而韩语, 同样也是因为这种原因, 才出现的书写系统, 现今的韩语最早出现的目的是因为一个被分封的诸侯想要独立, 参照汉字书写造就了自己的文字书写系统.</p>
<p>汉字自身从出现开始就一直不断的被完善, 被改造. 但是无论是某一次的改造的目的都只是被利用而已, 嫌甲骨文书写麻烦, 直到很长时间, 造就了隶书, 为了书写的美观, 造就了楷书, 为了减少汉字的复杂出现了行书; 汉字到目前最后一次大的改动实行简体字, 同样是利用文字而达到一定目的.</p>
<p>文字被创造以及破灭就是人类自身的问题, 当人类有了独立思考的能力之后, 让每个人都有自己的想法, 从而影响着很多事情. 人类有自己的私欲, 导致一切可以被利用的东西都当成了工具. 汉字是这样, 罗马字也是这样.</p>
<p>每一次的文字变革都有其支持者, 也有其反对者, 也真是因为这样才造就了汉字今天的两种版本.</p>
<p>说不上是好或坏, 这是人类社会自身的问题.</p>
<p>就像我在利用文字写这段话一样, 文字的出现就只是被利用.</p>
<p>我可以选择用任何一种文字来写, 当然前提是我得学会怎么去利用文字.</p>
<p>如果你愿意, 你可以利用你会的文字去读 《甲骨文》吧.</p>
</div><footer class="post__foot u-cf"><ul class="post__tag u-fl"><li class="post__tag__item"><a href="/tags/甲骨文/" class="post__tag__link">甲骨文</a></li></ul><a href="/post/used-word/#disqus_thread" class="post__foot-link u-fr">0 COMMENTS</a></footer></article><article class="post"><header class="post__head"><time datetime="2017-02-09T12:49:41.000Z" class="post__time">February 9, 2017</time><h1 class="post__title"><a href="/post/iaceob-come-back/">舊博新開</a></h1></header><div class="post__main echo"><p>算算日子, 恩, 總算是把以前博客給弄好了, 現在重新開放.</p>
<p>這次直接拋棄了 wordpress 直接靜態化成 html 也放入到了 github 中, 與現在的博客放在一起.</p>
<p>關於訪問, 做了一層中間代理, 從日本的服務器訪問 github 做代理到 <code>iaceob.3u3.me</code> 域名去, 同時在這個博客中用 robots 禁止爬蟲抓取當前博客的 <code>/iaceob</code> 目錄.</p>
<p>現博客目錄結構如下:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">├── archives</span><br><span class="line">├── CNAME</span><br><span class="line">├── css</span><br><span class="line">├── fonts</span><br><span class="line">├── index.html</span><br><span class="line">├── page</span><br><span class="line">├── post</span><br><span class="line">├── README.md</span><br><span class="line">├── robots.txt</span><br><span class="line">├── sitemap.xml</span><br><span class="line">├── tags</span><br><span class="line">└── iaceob</span><br><span class="line">    ├── archives</span><br><span class="line">    ├── page</span><br><span class="line">    ├── robots.txt</span><br><span class="line">    ├── sitemap.xml</span><br><span class="line">    └── tag</span><br></pre></td></tr></table></figure>
<p>因此, 實際上 <code>blog.3u3.me/iaceob</code> 其實也是可以直接訪問原博客的, 只是在 robots 中禁止了不讓爬蟲去抓取.</p>
<p>這樣 <code>iaceob.3u3.me</code> 就能實現 https 訪問了.</p>
<p>關於 https 訪問, 當前博客也想到了用 https 訪問的方案了, 因為這個博客本身是託管於 github 的, 如果直接用 github 提供的 io 域名訪問, 其實本身就支持 https, 但是, 因為使用了 CNAME 解析, 而 github 的 ssl 無法支持被 CNAME 的域名, 因此無法直接使用 https 訪問.<br>網絡中也搜索過相關問題解決方案, 包括很多另外的第三方再次託管, 瞭解之後發現, 那些第三方實際上就像和爬蟲一樣的東西, 實現的方案其實是將放到 github 的文章再次抓取到第三方的 web 服務中, 而你的域名是交給第三方去實現 ssl 的, 變相的看來, 就是第三方提供了一個支持 ssl 的虛擬空間而已, 且有些服務抓取的還不及時, 換皮不換藥, 還不一定穩定(但不失為一個好辦法).<br>這裡想到的解決方案, 前提是要有一臺自己的服務器(因此其實也算不上是太好的方案, 並不是沒人都有自己的服務器), 且能夠連接到 github , 對, 看來你想到什麼了.<br>其實原理很簡單, 就和我的舊博客一樣, 做一次代理即可, github 中不要使用 CNAME, 將你的域名指向到你的服務器, 然後在 nginx 中對域名進行代理到 github, 然後在 nginx 中實現 ssl, 這樣就完成了, 這樣就不會有不及時的問題, 也完全在自己控制.<br>如果不想要 github.io 的那份博客被搜索引擎抓取, 可直接在 robots 中禁止任何爬蟲抓取, 然後在自己的服務器中攔截 robots 設置 CNAME 的域名想要被抓取的域名, 或者簡單暴力的直接到各個搜索引擎告訴不要抓取那個 io 的域名即可(雖然我不知道搜索引擎有沒有提供這種功能).</p>
<p>最後</p>
<p>關於原博客重開, 樣式其實就是抄的當前用的這個樣式, 然後改了改, 還有文章因為是通過抓取來的, 而不是直接從數據庫中查的, wordpress 的數據表實在太麻煩了, 因此可能會有亂象出現, 不在意就好.</p>
<p>有趣的是, 這次重新弄之前的博客, 以外讓我學會了用 Inkscape, 雖然就只是非常簡單的使用, 重開的博客 <a href="https://iaceob.3u3.me/favicon.svg" target="_blank" rel="external">favicon</a> 就是我自己畫的.</p>
<p>從放棄原博客開始, 說要重新弄, 到現在都已經超過一年了, 時間過的真快, 拖延症也越來越嚴重了.</p>
<p>原博客以後就不會在動了, 就這麼放著吧.</p>
<p>今年的第一件要做的事情完成了.</p>
<p>就這樣.</p>
</div><footer class="post__foot u-cf"><ul class="post__tag u-fl"><li class="post__tag__item"><a href="/tags/iaceob/" class="post__tag__link">iaceob</a></li><li class="post__tag__item"><a href="/tags/blog/" class="post__tag__link">blog</a></li></ul><a href="/post/iaceob-come-back/#disqus_thread" class="post__foot-link u-fr">0 COMMENTS</a></footer></article><article class="post"><header class="post__head"><time datetime="2017-02-03T14:04:24.000Z" class="post__time">February 3, 2017</time><h1 class="post__title"><a href="/post/oracle-election/">《甲骨文》 選舉 節選</a></h1></header><div class="post__main echo"><p>「沒錯，」石磊說：「她不是我的親生母親。我父親的原配 – 我母親 – 是幾年前在大陸去世了， 她沒有來成臺灣。一九四九年時，她不在南京，因為她要照顧她公公。她留了下來，希望我們後來會回去。」<br>街上下起了小雨。現在我明白了，為什麼石教授在回想他是哪一年結婚的時候，不像他回想古文物出土的日期那麼快速。那就是中國的歷史：你記得的事加上你試著要遺忘的事。在等計程車時，他的兒子轉向我。<br>「我比我父親晚一點來臺灣，」他說：「離開大陸之前，我母親讓我轉告父親一個口信。她說：萬一發生什麼事，他們不得不分開，他應該要再婚。我想她已感覺到，國家會走向分裂。」</p>
</div><footer class="post__foot u-cf"><ul class="post__tag u-fl"><li class="post__tag__item"><a href="/tags/甲骨文/" class="post__tag__link">甲骨文</a></li></ul><a href="/post/oracle-election/#disqus_thread" class="post__foot-link u-fr">0 COMMENTS</a></footer></article><article class="post"><header class="post__head"><time datetime="2017-01-27T15:26:15.000Z" class="post__time">January 27, 2017</time><h1 class="post__title"><a href="/post/moan-part-3/">再來呻吟</a></h1></header><div class="post__main echo"><p>嗯.<br>又來發廢文.</p>
<p>最近越來越發現, 喔不, 是真的接近於擺脫低頭族. 也不說這是一件多麼值得慶幸的事情, 反而以目前的狀況而言, 會被很多人覺得是自己格格不入, 但是這種狀態還會繼續下去, 工具應該是你去用它, 而不是讓工具來玩你.</p>
<p>也就是因為這樣, 幾乎和來往過的人都很少有在聯絡, 當然, 這很大一部分也是自己的問題, 可以說的事情越來越少, 走的也越遠, 不過真正在意的並不會就因為這樣而淡化, 就是會有這樣的人 ~</p>
<p>活在現實裡吧.</p>
<p>還有喔, 這個約定應該說已經兌現了, 得有兩年多了吧.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">                                                 PM    AM</span><br><span class="line">| | | | | 22 | | | | | | | | | 23 | | | | | | | | | 00 | | | | | | | | | 01 | | | |</span><br></pre></td></tr></table></figure>
<p>可惜勒, 也只能是我知道了昂  ╮(╯_╰)╭</p>
<p>外面炮竹聲都響起來了.</p>
<p>算了, 就到這裡吧. 平時總是能想到好多, 反而到了要說出來的時候又全都憋回去了.</p>
<p>真是個無聊的人, 對, 就是這個人 ←_← </p>
<p>睡覺吧.</p>
<p>偶然, ↓↓↓↓</p>
<iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width="100%" height="86" src="//music.163.com/outchain/player?type=2&id=32639022&auto=0&height=66"></iframe>

</div><footer class="post__foot u-cf"><ul class="post__tag u-fl"><li class="post__tag__item"><a href="/tags/moan/" class="post__tag__link">moan</a></li></ul><a href="/post/moan-part-3/#disqus_thread" class="post__foot-link u-fr">0 COMMENTS</a></footer></article><article class="post"><header class="post__head"><time datetime="2017-01-21T07:13:12.000Z" class="post__time">January 21, 2017</time><h1 class="post__title"><a href="/post/oracle-sandstorm/">《甲骨文》 風沙 節選</a></h1></header><div class="post__main echo"><p>閒著無事, 我在腦海裡重建了這座小村莊: 一九七六年, 黨書記整修房子, 他用只有他才能訂閱的報紙當作壁紙, 含蓄地昭顯了自己的權威. 同一年, 房子修好了, 毛主席也死了, 開始了改革. 七年之後, 其他的村民也開始裝修房屋, 這回用的壁紙上寫的是跟改變中的經濟有關的標題. 一些村民在農休季節去了城裡當建築工人, 賺更多的錢, 耕種變得沒什麼吸引力. 到了一九九〇年代, 他們則離開鄉村, 尋找更好的出路. 剛開始是年輕人, 接著是中年人. 最後剩下的是老人, 只有他們還擁有本地色彩的記憶: 哪個當官的有權利, 村裡誰的田最多, 哪家在村裡住的時間最久. 所有這些記憶慢慢地望山坡下滑, 逐漸被大一點的村莊, 城鎮, 城市, 國家吞沒. 最後, 老人死了, 小村莊一片死寂.</p>
<p>這就是現代中國: 只需十年的時間, 一個地方就熟透得可以拿來考古. 我拿起背包, 掉頭向山坡下有人住的村子走去.</p>
</div><footer class="post__foot u-cf"><ul class="post__tag u-fl"><li class="post__tag__item"><a href="/tags/節選/" class="post__tag__link">節選</a></li><li class="post__tag__item"><a href="/tags/甲骨文/" class="post__tag__link">甲骨文</a></li></ul><a href="/post/oracle-sandstorm/#disqus_thread" class="post__foot-link u-fr">0 COMMENTS</a></footer></article><article class="post"><header class="post__head"><time datetime="2017-01-07T15:49:40.000Z" class="post__time">January 7, 2017</time><h1 class="post__title"><a href="/post/nginx-strange-403-forbidden-bug/">Nginx 奇怪的 403 Forbidden 問題</a></h1></header><div class="post__main echo"><p>說是要將原博客內容靜態化的嘛, 為了在解析原博的文章時能夠快速的獲取, 用 <code>wget</code> 將原博客的所有內容都下載到本地了, 但是本地之前從沒安裝過 web 服務, 因此就現安裝了個 nginx, 安裝過程都很順利, 但是在配置訪問路徑卻遇到了 <code>403 Forbidden</code> 的錯誤, 能出現這個錯誤, 無非就是在 nginx 的網站配置中未指定 <code>index</code> (或者配置的路徑沒有 index 文件), 再有就是配置的路徑權限問題.</p>
<p>然而, 我測試了很多次, <code>index</code> 是有設置的, 且配置的路徑中也就 index 文件, 那就不應該是這個問題.</p>
<p>那很有可能是路徑權限的問題, 我看了下 nginx 安裝後默認生成的 web 目錄下的權限, 和我的 web 目錄權限, 發現都是一樣的, 差別就是 nginx 的 web 目錄所屬人和組是 <code>root</code> 而我的 web 目錄是當前賬戶的.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">~$ ls -la /usr/share/nginx/html</span><br><span class="line">drwxr-xr-x 2 root root 4096 11月 19 04:14 .</span><br><span class="line">drwxr-xr-x 3 root root 4096 11月 19 04:14 ..</span><br><span class="line">-rw-r--r-- 1 root root  537 11月 19 04:14 50x.html</span><br><span class="line">-rw-r--r-- 1 root root  612 11月 19 04:14 index.html</span><br><span class="line"></span><br><span class="line">~$ ls -la dev/wwwroot/</span><br><span class="line">drwxr-xr-x 4 iaceob iaceob 4096  1月  7 23:46 .</span><br><span class="line">drwxr-xr-x 3 iaceob iaceob 4096  1月  7 23:44 ..</span><br><span class="line">-rw-r--r-- 1 iaceob iaceob    7  1月  7 23:18 index.html</span><br><span class="line">drwxr-xr-x 6 iaceob iaceob 4096  6月 25  2016 store</span><br></pre></td></tr></table></figure>
<p>然後就測試將這個 web 目錄所屬改成 root, 但是仍然是 403.</p>
<p>去搜索 nginx 403 錯誤出來的結果, 解決方案, 大致幾種</p>
<ul>
<li>給 web 目錄 www-data(nginx) 賬戶權限<br>在安裝 nginx 後, 壓根就沒給我建立這個賬戶</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">~$ id www-data</span><br><span class="line">id: ‘www-data’: no such user</span><br><span class="line">~$ id nginx</span><br><span class="line">id: ‘nginx’: no such user</span><br></pre></td></tr></table></figure>
<ul>
<li><p>給 web 目錄 775 權限<br>測試後發現仍然不行, 甚至設置 777 權限也不行 = =</p>
</li>
<li><p>修改 nginx 啟動賬戶</p>
</li>
</ul>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#user html;</span></span><br><span class="line"><span class="attribute">worker_processes</span>  <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">#error_log  logs/error.log;</span></span><br><span class="line"><span class="comment">#error_log  logs/error.log  notice;</span></span><br><span class="line"><span class="comment">#error_log  logs/error.log  info;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#pid        logs/nginx.pid;</span></span><br></pre></td></tr></table></figure>
<p>上面這個是安裝後的默認配置, <code>user</code> 這個配置是直接被註釋的, 那也就是不可能是啟動賬戶的問題, 拿 <code>systemctl</code> 啟動的 nginx 那默認賬戶應該就是 root.</p>
<p>那看似也不是目錄權限的問題了…</p>
<p>最後, 在測試了次, 把目錄建立在非當前賬戶目錄下, 平時為了方便, 所有工程都是放在自己賬戶根目錄下的, 測試時在 /opt 下建立了一個 web 目錄, 將 nginx 配置指向到該目錄, 竟然就可以了 (╯°Д°)╯ ┻━┻<br>在 opt 建立目錄需要用 root 賬戶才行, 為了測試是不是自己賬戶的所屬目錄不能作為 web 目錄, 將該目錄屬主和屬組都改成自己賬戶, 發現仍然可以 (╯°Д°)╯ ┻━┻</p>
<p>之所以優先設置自己賬戶目錄, 一是方便, 在一個另外一台線上的服務器就是這麼配置的都沒有發生問題, 不知道是不是新版本問題還是怎樣.<br>現在我能想到的問題有可能是跨硬盤的問題, 機器上有兩塊硬盤, 一個是 ssd 掛載的是 /home 也就是平時用的, 另一塊是機械硬盤, 掛了好幾個節點(純屬瞎猜).</p>
<p>問題算是解決了 = =</p>
<p>之後就將 opt 的 web 目錄, 放了一個軟鏈接到 home 來, 後面又測試了下, 將 nginx 的配置路徑改成 home 的軟鏈接也不行, 但是其他位置的就可以 (還放了一個 <code>/data/www -&gt; /opt/www</code> 的軟鏈接), <code>/opt/www</code> 和 <code>/data/www</code> 都可以, 就是軟鏈接到 home 的又變成 403 了.</p>
<p>奇怪 = =</p>
<p>該怎麼解釋這個問題了 .</p>
</div><footer class="post__foot u-cf"><ul class="post__tag u-fl"><li class="post__tag__item"><a href="/tags/nginx/" class="post__tag__link">nginx</a></li><li class="post__tag__item"><a href="/tags/403/" class="post__tag__link">403</a></li></ul><a href="/post/nginx-strange-403-forbidden-bug/#disqus_thread" class="post__foot-link u-fr">0 COMMENTS</a></footer></article><article class="post"><header class="post__head"><time datetime="2016-12-31T13:50:44.000Z" class="post__time">December 31, 2016</time><h1 class="post__title"><a href="/post/moan-part-2/">繼續呻吟</a></h1></header><div class="post__main echo"><p>嗯 …<br>這裡沒有年終總結, 也從來都沒年終總結, 這個年也還沒完, 對.</p>
<p>不知道怎的, 一下子想到了某年前的今天 <a href="http://old.3u3.me/js-parse-lyric/" title="至少在我沒將原文章恢復前, 是無法反問的" target="_blank" rel="external">js 解析歌词</a>, 就是在大半夜寫的這篇文章, 其實寫的是什麼都忘記了, 只記得當時寫了好久, 已經第二天了.</p>
<p>沒多大變化, 又這樣度過這一年, 做了不少決定, 跑了半個天朝, 但是了 ╮(╯_╰)╭ , 仍然是一切如初, 甚至連一件值得提起的事情都沒有.</p>
<p>老早老早以前, 就說過, 不浮躁, 可是現在看回去, 不僅是沒做到, 而是真的浮躁起來了, 而且還養成了諸多自己都覺得是不好的習慣, 說起來, 也是自己太高估自己的自制力. 努力想要改變, 執行力又不夠, 想得總是很好, 但是就是沒法或者說拖延不想去做.</p>
<p>變成檢討文了, 還是停下來吧.</p>
<p>總之了, 這一年說不上好與不好, 只是完美的日常罷了, 很平淡無奇.</p>
<p>那麼. 接下來, 計劃下一年必須要做的事情, 至少會為此付諸行動.</p>
<ul>
<li>原博重新開放, 僅供閱覽</li>
<li>尋找對味的團隊</li>
<li>日語學習</li>
</ul>
<p>原博客重開實際已經早早就說要弄的了, 可惜也就因為這一年來將很多空閒時間都懶下來, 就沒有過認真做些有意義的事情, 一拖在拖, 到最後也沒做完.</p>
<p>對味團隊, 不求多好, 畢竟自身也存在很多不足. 但是 至少 不應該是像現在這樣. 沒有規劃, 想一出是一出. 如果哪天有心情, 後面會把這些經歷拿出來探討. 做好正確的選擇真的很重要.</p>
<p>日語學習. 嗯. 將是一整年的目標. 理由就只是興趣而已, 學習到至少我能夠用日語寫出整篇文章 ~</p>
<p>如果可能, 想再去看一本書, 今年把 《消失的江城》 看完了. 第二本(《甲骨文》)也因為後期懶惰放那積了一層灰, 並不是不想看, 現階段讀書大部分都是在百無聊賴 (實際上是無法接觸電子設備) 的時候才會翻閱書籍, 而當下這個機會又一次變少了, 導致這本書過了這麼久還沒看完一半. 書單中的下一本是 《銀河系漫遊指南》. 來見識下 <a href="http://coolshell.cn/articles/11170.html" target="_blank" rel="external">42</a> 這個人生和宇宙终级问题的答案吧.</p>
<p>順便說說, 今年本要執行的一個計劃 書籍共享. 但是卻沒有任何動作以及不準備在執行這計劃的原因, 一則是懶 = =, 再有, 後來關注了相關方面的信息, 主要是有兩點, 對於事物的多方考慮和有償的知識(物品)獲取.<br>若書籍共享計劃真可行, 是有可能便於讀著更加方便的獲取自己的所需, 但是這樣就會導致出書的人很不滿而導致質量下降, 原因就是, 作者以及出版商將能獲取到的利潤會進一步減少, 現今互聯網本身就如此發達, 閱讀紙質書的人已經很少, 如果真要改變也不應該是書籍共享, 而是考慮用更進一步的方式去閱讀, 例如 kindle.<br>再一個, 有償的知識(物品)獲取, 你不應該有任何免費獲取的概念, 所有的事物都應該遵循等價交換的原則, 你所閱讀的書籍是作者花了很多心血的作品.</p>
<p>那麼, 讓日常繼續吧.</p>
<iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width="100%" height="86" src="//music.163.com/outchain/player?type=2&id=489608&auto=0&height=66"></iframe>

<p>抱歉, 夢裡的那隻貓, 做了很不應該做的事. 有可能這是自己的本性, 但是對不起.</p>
<p>又到了第二年了.</p>
</div><footer class="post__foot u-cf"><ul class="post__tag u-fl"><li class="post__tag__item"><a href="/tags/moan/" class="post__tag__link">moan</a></li></ul><a href="/post/moan-part-2/#disqus_thread" class="post__foot-link u-fr">0 COMMENTS</a></footer></article><article class="post"><header class="post__head"><time datetime="2016-12-17T07:08:47.000Z" class="post__time">December 17, 2016</time><h1 class="post__title"><a href="/post/final-ng-II-part-2/">ng2 app</a></h1></header><div class="post__main echo"><p>繼 <a href="/post/final-ng-II-part-1" title="ng2 ngcli">上一文</a>, 通過 ngcli 已經建立了一個可運行的工程.</p>
<p>這次來熟悉 ng2 開發方式.</p>
<p>首先, 執行 <code>ng s</code> (ng server 別名) 來啟動使用 ngcli 創建的工程, 瀏覽器訪問 <code>localhost:4200</code>, 會看到一行很大的 <code>app works!</code> , 那麼就啟動成功了.</p>
<h2 id="運作方式"><a href="#運作方式" class="headerlink" title="運作方式"></a>運作方式</h2><p>在開始進行編碼之前, 先來認知 ng2 <code>component</code>, ng2 應用是由很多個 component 組成的, 一個頁面中可以有多個 component, 因此在構建頁面時可以將不同功能部分代碼拆解城多個 component.</p>
<p>打開 <code>src/app/app.component.ts</code> 文件, 可以看到這些代碼</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Component &#125; from <span class="string">'@angular/core'</span>;</span><br><span class="line"></span><br><span class="line">@Component(&#123;</span><br><span class="line">  selector: <span class="string">'app-root'</span>,</span><br><span class="line">  templateUrl: <span class="string">'./app.component.html'</span>,</span><br><span class="line">  styleUrls: [<span class="string">'./app.component.css'</span>]</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> AppComponent &#123;</span><br><span class="line">  title = <span class="string">'app works!'</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>@Component</code> 是用來聲明這個 component, 裡面有三個值 (@ 是 es6 中提出的 <a href="http://es6.ruanyifeng.com/?search=decorator&amp;x=0&amp;y=0#docs/decorator" target="_blank" rel="external">decorator</a> 語法, ):</p>
<ol>
<li><code>selector</code> 在 html 中的某個節點上使用當前 component (支持 css 選擇器, 但是如果選擇器有多個結果, 僅使用第一個)</li>
<li><code>templateUrl</code> 此 component 使用的模板文件地址</li>
<li><code>styleUrls</code> 此 component 使用的樣式文件</li>
</ol>
<p>這里默認創建的 component 所選取的節點 <code>app-root</code> 就是在 <code>src/index.html</code> 裡面</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!doctype html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>Test<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">base</span> <span class="attr">href</span>=<span class="string">"/"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"icon"</span> <span class="attr">type</span>=<span class="string">"image/x-icon"</span> <span class="attr">href</span>=<span class="string">"favicon.ico"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">app-root</span>&gt;</span>Loading...<span class="tag">&lt;/<span class="name">app-root</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>簡單的理解就是, 當執行到 app.component.ts 時, 選取 app-root 節點, 將 app component 的內容渲染進去, 整個執行過程大致為:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">src/main.ts -&gt; src/app/index.ts -&gt; [src/app/app.module.ts | src/app/app.component.ts]</span><br></pre></td></tr></table></figure>
<p>在 app.component.ts 中, 有設置一個變量 <code>title = &#39;app works!&#39;;</code> 這個 app works! 就是開啟這個應用後訪問瀏覽器所看到的文字.</p>
<p>那這個變量又是如何顯示到頁面的了?</p>
<h2 id="數據綁定"><a href="#數據綁定" class="headerlink" title="數據綁定"></a>數據綁定</h2><h3 id="模板取值"><a href="#模板取值" class="headerlink" title="模板取值"></a>模板取值</h3><p>數據綁定這個應該不陌生, 在 ng1 中也是有數據綁定概念的, ng1 中的數據綁定實現, 是通過在控制器 (controller) 中設置變量, 模板從控制器中使用  方式獲取在控制器中的變量, 獲取使用 <code>ng-bind</code> 屬性.</p>
<p>在 ng2 中也有數據綁定, 且使用方式與 ng1 也大體相同, 同是使用  在模板中獲取變量, 但是 <code>ng-bind</code> 屬性綁定方式略有改變.</p>
<p>打開 <code>src/app/app.component.html</code> 會看到</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span></span><br><span class="line">  &#123;&#123;title&#125;&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>這就是 app component 這個組件的模板, 展示 title 的內容.</p>
<blockquote>
<p>app.component.ts 在完成自己組件內容後, 將結果寫入到 app-root 標籤中, 這就是 component 的整個流程.</p>
</blockquote>
<p>接下來詳細看看的數據綁定方式</p>
<p>用標識符取值方式, 與 ng1 大體相同, 可簡單的將其看為是一個臨時的在 html 中可執行 js 腳本的區域, 當然這個可執行的 js 空間作用域僅在當前這個 component 中, 可以直接調用這個 component 中的函數或者變量.</p>
<p>例如在 app.component.ts 中修改</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> AppComponent &#123;</span><br><span class="line">  title = <span class="string">'app works!'</span>;</span><br><span class="line"></span><br><span class="line">  getDate()&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Date</span>();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>接著在 app.component.html 中添加</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span></span><br><span class="line">  &#123;&#123;title&#125;&#125;</span><br><span class="line">  &#123;&#123;'Now: ' + getDate()&#125;&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>再打開瀏覽器就能看到</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app works! Now: Sat Dec 17 2016 16:12:50 GMT+0800 (CST)</span><br></pre></td></tr></table></figure>
<p>另外一種就是 bind 數據綁定方式, 寫在標籤屬性中</p>
<p>例如在模板中添加</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> [<span class="attr">placeholder</span>]=<span class="string">"holder"</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>在 app.component.ts 中添加</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">holder=<span class="string">'Name'</span>;</span><br></pre></td></tr></table></figure>
<p>再去看頁面, 就會發現多了一個輸入框, 且輸入框有默認文字 Name</p>
<blockquote>
<p><strong>與 ng1 不同之處:</strong><br>在 ng1 中, <code>ng-bind</code> 可以接收從控制器來的數據並展示, 但是 ng-bind 展示的內容是放入到標籤之中的, 而 ng2 的綁定方式略有改變, 沒有再使用 <code>ng-bind</code>, 如果要望標籤中寫入內容可通過使用標識符方式.<br>ng1 中若要給標籤屬性複製, 通過</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">title</span>=<span class="string">"&#123;&#123;title&#125;&#125;"</span>&gt;</span>test<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>而 ng2 則是直接使用 [] 包含屬性名, 配變量值<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span> [<span class="attr">title</span>]=<span class="string">"title"</span>&gt;</span>test<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>當然, ng2 也是支持與 ng1 一樣的方式給屬性賦值.</p>
</blockquote>
<h3 id="事件綁定"><a href="#事件綁定" class="headerlink" title="事件綁定"></a>事件綁定</h3><p>事件用來捕獲用戶操作, 在 ng2 中可通過 <code>(event name)=&quot;something&quot;</code> 來進行事件捕獲.</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">name</span>=<span class="string">"button"</span> (<span class="attr">click</span>)=<span class="string">"testEvent($event)"</span>&gt;</span>Click<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">testEvent(event)&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'Test event'</span>, event);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在 app.component.html 與 app.component.ts 分別加入後, 打開瀏覽器, 點擊 Click 按鈕, 會看到控制台打印了一條 ‘Test event’ 的日誌, 且後面有一次此次 event 的詳細信息.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Test event click &#123; target: &lt;button&gt;, buttons: 0, clientX: 24, clientY: 266, layerX: 24, layerY: 266 &#125;</span><br></pre></td></tr></table></figure>
<h3 id="雙向綁定"><a href="#雙向綁定" class="headerlink" title="雙向綁定"></a>雙向綁定</h3><p>與 ng1 形同, ng2 也支持數據的雙向綁定, 也就是無論是模板中修改了某個變量的值, 同時會在 component 中修改該變量的值, 使用方式與 ng1 大致相同.</p>
<p>在 app.component.html 中加入</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> [(<span class="attr">ngModel</span>)]=<span class="string">"title"</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>然後打開瀏覽器, 會看到一個輸入框, 且賦值為 <code>app works!</code>, 可以去嘗試修改這個輸入框會發生什麼事情.</p>
<h2 id="component-通信-amp-amp-流程控制"><a href="#component-通信-amp-amp-流程控制" class="headerlink" title="component 通信 &amp;&amp; 流程控制"></a>component 通信 &amp;&amp; 流程控制</h2><h3 id="Input"><a href="#Input" class="headerlink" title="Input"></a>Input</h3><p>一個頁面中可能存在多個 component, component 之間的通信可通過 <code>@Input</code> <code>@Output</code> 進行通信.</p>
<p>示例:</p>
<p>首先, 通過 <code>ng</code> 創建一個新的 component</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ng g c comp/show</span><br></pre></td></tr></table></figure>
<p>創建一個名為 show 的 component, 放置與 src/app/comp/show 目錄 (自動放置, 但是 comp 目錄需要自己創建, 具體參考 <a href="/post/final-ng-II-part-1">ng2 ngcli</a>).</p>
<p>創建完成後, 目錄結構像這樣</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">src/app/comp</span><br><span class="line">└── show</span><br><span class="line">    ├── show.component.css</span><br><span class="line">    ├── show.component.html</span><br><span class="line">    ├── show.component.spec.ts</span><br><span class="line">    └── show.component.ts</span><br></pre></td></tr></table></figure>
<p>接著, 到 app.component.html 中增加 </p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">app-show</span>&gt;</span><span class="tag">&lt;/<span class="name">app-show</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>讓 show 組件的內容顯示在 app 中, 這裡的 app-show 標籤可以是自定義的, 但是自定義的話, 就需要去修改 <code>show.component.ts</code> 中關於 component 組件聲明的 <code>selector</code> 選擇器. 只要二者相同即可.</p>
<p>這時打開網頁就能看到, 在頁面中已經加入了 show component 的內容了.</p>
<p>接下來, 使用創建一個數據模型(接口) interface 用於指定數據格式. (interface 是 typescript 提供的語法, 其目的就是為了創建一個統一的數據模型.)</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ng g interface entity/item</span><br></pre></td></tr></table></figure>
<p>編輯添加的文件, 修改內容為</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> Item &#123;</span><br><span class="line">    id: <span class="built_in">number</span>;</span><br><span class="line">    value: <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在 app.component.ts 頂部引入 Item</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Item &#125; from <span class="string">'./entity/item'</span>;</span><br></pre></td></tr></table></figure>
<p>並且加入幾個預定義數據, 最終 app.component.ts 像這樣</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Component &#125; from <span class="string">'@angular/core'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Item &#125; from <span class="string">'./entity/item'</span>;</span><br><span class="line"></span><br><span class="line">@Component(&#123;</span><br><span class="line">    selector: <span class="string">'app-root'</span>,</span><br><span class="line">    templateUrl: <span class="string">'./app.component.html'</span>,</span><br><span class="line">    styleUrls: [<span class="string">'./app.component.css'</span>]</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> AppComponent &#123;</span><br><span class="line">    title = <span class="string">'app works!'</span>;</span><br><span class="line"></span><br><span class="line">    holder = <span class="string">'Name'</span>;</span><br><span class="line"></span><br><span class="line">    items: Item[] = [</span><br><span class="line">      &#123;id: <span class="number">1</span>, value: <span class="string">'Europe'</span>&#125;,</span><br><span class="line">      &#123;id: <span class="number">2</span>, value: <span class="string">'Africa'</span>&#125;,</span><br><span class="line">      &#123;id: <span class="number">3</span>, value: <span class="string">'Oceania'</span>&#125;</span><br><span class="line">    ];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> getDate() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Date</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> testEvent(event: MouseEvent) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'Test event'</span>, event);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>接下來的步驟就是通信的實現.</p>
<p>再次打開剛剛編輯的 app.component.html, 將剛剛添加的 app-show 添加一個屬性</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;app-show [itemList]=<span class="string">"items"</span>&gt;&lt;<span class="regexp">/app-show&gt;</span></span><br></pre></td></tr></table></figure>
<p>這裡表達的是, 將 itemList 視為一個屬性, 並且將 items 傳遞進 app-show 中, 那麼在 app-show 中就可以通過 <code>@Input</code> 來獲取這個 <code>itemList</code>, 因此修改 show.component.ts 為</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Component, OnInit, Input &#125; from <span class="string">'@angular/core'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Item &#125; from <span class="string">'../../entity/item'</span>;</span><br><span class="line"></span><br><span class="line">@Component(&#123;</span><br><span class="line">  selector: <span class="string">'app-show'</span>,</span><br><span class="line">  templateUrl: <span class="string">'./show.component.html'</span>,</span><br><span class="line">  styleUrls: [<span class="string">'./show.component.css'</span>]</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> ShowComponent <span class="keyword">implements</span> OnInit &#123;</span><br><span class="line"></span><br><span class="line">  @Input() itemList: Item[];</span><br><span class="line"></span><br><span class="line">  <span class="keyword">constructor</span>() &#123; &#125;</span><br><span class="line"></span><br><span class="line">  ngOnInit() &#123;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>首先, 從 <code>&#39;@angular/core&#39;</code> 中加入引用 <code>Input</code>, 接著引入 <code>Item</code> 因為 傳遞進來的數據就是 Item 類型.</p>
<p>之後就是新增的 <code>@Input() itemList: Item[];</code> 這樣一行代碼, 就是用來接收從 app component 中傳遞過來的 item 數據.<br>其 <code>@Input</code> 就是用來表示數據是從外部輸入進來, Input 默認將後面的變量名作為接收的屬性名稱, 同時也可以自定義, <code>@Input(itemList) items: item[]</code> , 這樣就表示是從 itemList 屬性接收屬性, 將值賦給 items 變量.</p>
<h3 id="流程控制"><a href="#流程控制" class="headerlink" title="流程控制"></a>流程控制</h3><h4 id="ngFor"><a href="#ngFor" class="headerlink" title="ngFor"></a>ngFor</h4><p>通過 Input 在 show 組件中已經能接收到從 app 組件中傳遞的 items<br>那麼, 在 show 組件中, 就能通過 ngFor 來展示這些 item.</p>
<p>修改 show.component.html 為如下內容:</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span> *<span class="attr">ngFor</span>=<span class="string">"let item of items"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">label</span> <span class="attr">htmlFor</span>=<span class="string">"&#123;&#123;item.id&#125;&#125;"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">"&#123;&#123;item.id&#125;&#125;"</span> <span class="attr">type</span>=<span class="string">"checkbox"</span>&gt;</span> &#123;&#123; item.value &#125;&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>這裡使用了 <code>*ngFor</code> 來遍歷從 app 組件中傳遞過來的 items.<br>需要注意的是 <code>htmlFor</code>, 此處主要是因為 for 為 javascript 關鍵字, 所以此處將其換為 htmlFor, 此外也可以只用 <code>attr.for</code> 的方式, 表示此為 html 屬性.</p>
<h4 id="ngIf"><a href="#ngIf" class="headerlink" title="ngIf"></a>ngIf</h4><p><code>ngIf</code> 用於進行邏輯判斷, 例如這裡, 如果有超過 2 個 item 就提示數量過多</p>
<p>那麼就在 show.component.html 最後加入</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span> *<span class="attr">ngIf</span>=<span class="string">"items.length &gt; 2"</span>&gt;</span>Items length <span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">"color: #f00"</span>&gt;</span>(&#123;&#123;items.length&#125;&#125;)<span class="tag">&lt;/<span class="name">span</span>&gt;</span> too much<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="Output"><a href="#Output" class="headerlink" title="Output"></a>Output</h3><p>為了說明 Output, 再來建立一個 component 叫做 add, 用向 app 的 items 中添加新的數據.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ng g c comp/add</span><br></pre></td></tr></table></figure>
<p>然後將 add 組件的模板加入到 app 中, 也就是在 app.component.html 中加入 app-add 標籤, 並且在標籤中添加一個叫做 addItem 的事件綁定</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">app-add</span> (<span class="attr">addAppItem</span>)=<span class="string">"addAppItem($event)"</span>&gt;</span><span class="tag">&lt;/<span class="name">app-add</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>左側的 <code>(addItem)</code> 是用於給 add 組件向外綁定事件指定的事件名稱, 右側的 <code>addItem($event)</code> 則是調用此模板所屬的組件, 此處所屬的組件是 app, 也就是調用 <code>app.component.ts</code> 中的 addItem 方法.<br>那麼就在 app.component.ts 中添加該方法.</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">addItem(value) &#123;</span><br><span class="line">    <span class="keyword">this</span>.items.push(&#123;</span><br><span class="line">        id: +<span class="keyword">new</span> <span class="built_in">Date</span>(),</span><br><span class="line">        value: value</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>剩下來的事就是, 在 add 組件中, 增加一個表單, 使其添加的數據提交給 app 組件中的 addItem 方法就能夠完成數據的添加了.</p>
<p>add.component.html</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> [(<span class="attr">ngModel</span>)]=<span class="string">"value"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> (<span class="attr">click</span>)=<span class="string">"addItem($event)"</span>&gt;</span>Add<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>add.component.ts</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Component, OnInit &#125; from <span class="string">'@angular/core'</span>;</span><br><span class="line"></span><br><span class="line">@Component(&#123;</span><br><span class="line">  selector: <span class="string">'app-add'</span>,</span><br><span class="line">  templateUrl: <span class="string">'./add.component.html'</span>,</span><br><span class="line">  styleUrls: [<span class="string">'./add.component.css'</span>]</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> AddComponent <span class="keyword">implements</span> OnInit &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">constructor</span>() &#123; &#125;</span><br><span class="line"></span><br><span class="line">  ngOnInit() &#123;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  value;</span><br><span class="line"></span><br><span class="line">  addItem($event) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.value);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>那麼, add 的表單功能完成, 並且能收到添加的 item, 最後, 就是將收到的值傳給 app 組件, 將其加入到 app 組件中的 items 然後在 show 組件中進行顯示.</p>
<p>傳遞 add 中輸入的值就是使用 <code>@Output</code></p>
<p>Output 使用, 首先在 add 組件中引入 Output 以及 EventEmitter, 在 add.component.ts 中修改 import</p>
<p>add.component.ts</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Component, OnInit, Output, EventEmitter &#125; from <span class="string">'@angular/core'</span>;</span><br></pre></td></tr></table></figure>
<p>然後添加一個用來處理事件的 EventEmmitter, 將 add 組件中的添加事件通過 EventEmmitter 傳遞出此組件到其他組件.</p>
<p>最終 add.component.ts 看起來像這樣</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Component, OnInit, Output, EventEmitter &#125; from <span class="string">'@angular/core'</span>;</span><br><span class="line"></span><br><span class="line">@Component(&#123;</span><br><span class="line">  selector: <span class="string">'app-add'</span>,</span><br><span class="line">  templateUrl: <span class="string">'./add.component.html'</span>,</span><br><span class="line">  styleUrls: [<span class="string">'./add.component.css'</span>]</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> AddComponent <span class="keyword">implements</span> OnInit &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">constructor</span>() &#123; &#125;</span><br><span class="line"></span><br><span class="line">  ngOnInit() &#123;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  value;</span><br><span class="line"></span><br><span class="line">  @Output() addAppItem = <span class="keyword">new</span> EventEmitter();</span><br><span class="line"></span><br><span class="line">  addItem($event) &#123;</span><br><span class="line">    <span class="comment">// console.log(this.value);</span></span><br><span class="line">    <span class="keyword">this</span>.addAppItem.emit(<span class="keyword">this</span>.value);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>@Output() addAppItem = new EventEmitter();</code> 就是用來創建一個事件, addItem 是 add 組件中定義的事件, 用於接收 add 模板的點擊, 當點擊後, 將這個事件通過 上面創建的 EventEmitter 轉發出此組件所在的父組件, 此處也就是 app 中, 至於最終尋找的是父組件中的哪一個事件, 與 Input 一樣, Output 默認去後面的參數名, 也可以通過 <code>@Output(&#39;name&#39;)</code> 指定.</p>
<p>到這裡, component 通信以及流程控制就完成了, 從添加到展示全部實現.</p>
<h2 id="樣式"><a href="#樣式" class="headerlink" title="樣式"></a>樣式</h2><p>ng2 與 ng1 還有個很大不同的地方是, ng1 中樣式的管理方式, 任何一個控制器所使用 class 都是通用的. 而 ng2 則增加了作用域的概念, 看使用 ngcli 創建的 component 就能發現, 創建組件的時候, 給增加了 一個 name.component.css 的文件, 該文件就是這個組件所獨有的樣式文件, 添加的任何樣式都不會影響到其他的組件, 同時一個組件中還可以使用多個樣式文件, 只要在 component 聲明中指定文件地址即可</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@Component(&#123;</span><br><span class="line">  selector: <span class="string">'app-add'</span>,</span><br><span class="line">  templateUrl: <span class="string">'./add.component.html'</span>,</span><br><span class="line">  styleUrls: [<span class="string">'./add.component.css'</span>, <span class="string">'./add-2.component.css'</span>]</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>除了獨有的樣式文件, 也有所有公用的樣式文件, 該文件的位置為 <code>src/styles.css</code> 在該文件中添加的樣式是所有組件都能夠使用的.</p>
<p>一些測試.<br>如上面案例的列表展示, 實現隔行換色的效果.</p>
<p>在 show.component.css 中添加 light 樣式</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.light</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: <span class="number">#ccc</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然後修改 show.component.html 的遍歷</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span> *<span class="attr">ngFor</span>=<span class="string">"let item of items; let i = index"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">label</span> <span class="attr">htmlFor</span>=<span class="string">"&#123;&#123;item.id&#125;&#125;"</span> [<span class="attr">ngClass</span>]=<span class="string">"&#123;'light': i%2==0&#125;"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">"&#123;&#123;item.id&#125;&#125;"</span> <span class="attr">type</span>=<span class="string">"checkbox"</span>&gt;</span> &#123;&#123; item.value &#125;&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>這裡, 在 ngFor 中增加了一個獲取當前索引的變量 i, 接著, 在 label 標籤中增加了 ngClass 用來實現隔行換色.</p>
<p>如果, 將 light 樣式放入到 add.component.css 中就會發現, 隔行換色沒有了效果, 放入到 src/styles.css 中發現也是可用的.</p>
<h2 id="總結"><a href="#總結" class="headerlink" title="總結"></a>總結</h2><p>ng2 中一個比較亂的地方, 就是各種使用 [] () , 很容易就弄暈, 是該用 [] 還是 (), 甚至還有 [()] 這種方式….<br>簡單的來說</p>
<ul>
<li><strong>[]</strong> 用來進行 <a href="#模板取值">屬性綁定</a><br>屬性綁定又分幾種<ul>
<li>html 標籤自帶屬性綁定, 例如 <code>[title]=&quot;title&quot;</code></li>
<li>ng2 提供的屬性, 例如 <code>[ngClass]=&quot;light&quot;</code>, 通常值會有獨特的用法</li>
<li>自定義屬性, 例如文中的 <code>[itemList]</code>, 但是這個自定義屬性一定要有去實現的地方, 文中的 itemList 就是讓 show.component.ts 使用 @Input 接收</li>
</ul>
</li>
<li><strong>()</strong> 用來進行 <a href="#事件綁定">事件綁定</a></li>
<li><strong>[()]</strong> 用來進行 <a href="#雙向綁定">雙向綁定</a></li>
<li><strong>*</strong> 用來標識是 ng2 提供的屬性<br>例如 <code>*ngFor</code> <code>*if</code> , 可在值中輸入 js 腳本</li>
</ul>
<p>ng2 相對 ng1 來說確實是複雜很多, 再有一個是這裡使用的是 TypeScript, 在寫 ng2 的時候至少應該要對 TypeScript 有著相應的瞭解, 雖然說可以切換為 JavaScript 或者其他腳本去實現, 看你喜好.</p>
<p>ng2 剩下來要說的就是路由功能了, 然而 angular2 現在雖然已經進入正式版了, 但是目前 ngcli 仍然不能創建路由 (ng g r), 關於路由的使用方式可以看官方文檔 <a href="https://angular.io/docs/ts/latest/guide/router.html" target="_blank" rel="external">Routing &amp; Navigation </a>.</p>
<p>都第二天了…. 寫好久 = =</p>
<p>就這樣吧 ~</p>
</div><footer class="post__foot u-cf"><ul class="post__tag u-fl"><li class="post__tag__item"><a href="/tags/ng2/" class="post__tag__link">ng2</a></li><li class="post__tag__item"><a href="/tags/angularjs/" class="post__tag__link">angularjs</a></li></ul><a href="/post/final-ng-II-part-2/#disqus_thread" class="post__foot-link u-fr">0 COMMENTS</a></footer></article></main><footer class="foot"><div class="foot-copy u-fl">&copy; 2017 iaceob</div><menu class="page-menu u-fr"><li class="page-menu__item"><span title="Previous" class="page-menu__link icon-arrow-left page-menu__link--disabled"></span></li><li class="page-menu__item"><a title="Next" href="/page/2/" class="page-menu__link icon-arrow-right"></a></li></menu></footer></body></html>